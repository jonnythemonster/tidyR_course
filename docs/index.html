<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Skript</title>

<script src="site_libs/header-attrs-2.21/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Effizientes Programmieren mit R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Skript</a>
</li>
<li>
  <a href="Loesungen_Script.html">Lösungen</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Skript</h1>

</div>


<p>Sommersemester 2023 | Stand: 2023-06-20</p>
<p>Hinweis: Zum jetzigen Zeitpunkt dieses Skipt in weiten Teilen eine
Übersetzung des großartigen Buches <a href="https://r4ds.hadley.nz">R
for Data Science</a>.</p>
<p>Dieses Werk ist lizenziert unter einer <a
href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons
Namensnennung-Nicht kommerziell 4.0 International Lizenz</a>. <img
src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png"
style="width:10.0%" /></p>
<p><img
src="https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/b467ee99-87e3-4663-ae27-aaf027f940ce_rw_1920.png?h=0573cb8b960ba2f2c8486188761f03e0"
style="width:45.0%"
alt="Eine Galaxie von tidyverse-bezogenen Hex-Aufklebern von Allison Horst" />
<img
src="https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/e684f0da-13b1-4d00-ab25-37814e79ee1e_rw_1920.png?h=2b72c110cfcf02f5cf1f74b558461c06"
style="width:45.0%" /></p>
<div id="einführung" class="section level1">
<h1>Einführung</h1>
<p>In diesem Kurs geht es um die Programmiersprache R. Doch was ist das
eigentlich?</p>
<div id="was-ist-r" class="section level2">
<h2>Was ist R</h2>
<p>R ist eine Programmiersprache und eine Umgebung für statistische
Berechnungen und Grafiken. Es wurde von Statistik-begeisterten Menschen
entwickelt und ist heute eine der am häufigsten verwendeten Sprachen in
der Datenanalyse und im Machine Learning. R bietet eine Vielzahl von
Paketen und Bibliotheken, die es Benutzern ermöglichen, verschiedene
statistische Analysen durchzuführen, Daten zu visualisieren und Modelle
zu entwickeln. Die Syntax von R ähnelt der von MATLAB und Python, aber R
wurde speziell für die statistische Analyse entwickelt.</p>
</div>
<div id="was-ist-rstudio" class="section level2">
<h2>Was ist RStudio</h2>
<p>RStudio ist eine integrierte Entwicklungsumgebung (IDE) für R. Es ist
eine kostenlose und quelloffene Software, die von Posit entwickelt wird
und die es Benutzern erleichtert, R-Code zu schreiben und auszuführen.
RStudio bietet eine Reihe von Funktionen, die den Workflow erleichtern,
einschließlich der Möglichkeit, R-Skripte zu erstellen, Daten und
Grafiken zu visualisieren, R-Pakete zu verwalten und RMarkdown-Dokumente
zu erstellen, die Text und Code kombinieren. RStudio ist eine der
beliebtesten IDEs für R und wird von vielen Benutzern aufgrund seiner
Benutzerfreundlichkeit, Funktionalität und Erweiterbarkeit
bevorzugt.</p>
</div>
<div id="das-tidyverse" class="section level2">
<h2>Das Tidyverse</h2>
<p>Tidyverse ist eine Sammlung von R-Paketen, die von Posit entwickelt
wurde, um die Arbeit mit Daten in R zu erleichtern. Tidyverse stellt
eine alternative Arbeitsweise zur Datenmanipulation und Visualisierung
im Vergleich zur traditionellen Basis-R-Syntax bereit.</p>
<p>Tidyverse bietet eine Vielzahl von Paketen, die speziell für die
Datenanalyse konzipiert sind. Diese Pakete sind so konzipiert, dass sie
nahtlos miteinander arbeiten und es dem Benutzer ermöglichen, Daten
schnell und effektiv zu manipulieren, zu bereinigen, zu transformieren
und zu visualisieren. Einige der wichtigsten Pakete in Tidyverse
sind:</p>
<ul>
<li>ggplot2: Ein Paket für die Erstellung ansprechender und
professioneller Grafiken.</li>
<li>dplyr: Ein Paket für die Datenmanipulation und -filterung.</li>
<li>tidyr: Ein Paket für die Bereinigung und Umstrukturierung von
Daten.</li>
<li>readr: Ein Paket für den Import von Daten aus verschiedenen
Dateiformaten.</li>
</ul>
<p>Tidyverse hat einige Vorteile gegenüber traditionellen
Basis-R-Syntax, insbesondere bei der Datenmanipulation. Der Einsatz des
Pipe-Operators (%&gt;%) ermöglicht es Benutzern, eine Folge von
Operationen in einer einzigen Zeile zu schreiben, was die Lesbarkeit und
den Workflow verbessert. Tidyverse ist auch so konzipiert, dass es gut
mit dem Konzept der “tidy data” (saubere Daten) arbeitet, das besagt,
dass Daten in einer strukturierten, les- und bearbeitbaren Art und Weise
organisiert sein sollten.</p>
<p>Insgesamt ist Tidyverse eine leistungsstarke und intuitive
Alternative zur traditionellen Basis-R-Syntax, die es Benutzern
ermöglicht, Daten effektiver und schneller zu manipulieren und zu
visualisieren. Es hat sich als eine der wichtigsten R-Bibliotheken für
die Datenanalyse und -visualisierung etabliert und wird von vielen
R-Entwicklern und Datenwissenschaftlern weltweit genutzt.</p>
</div>
<div id="tidy-data" class="section level2">
<h2>Tidy Data</h2>
<p>Unter diesem Begriff verbirgt sich die Idee, wie Daten aussehen
sollen. ,Sie sind in einer spezifischen, standardisierten Form
organisiert, um eine einfache Datenanalyse und -visualisierung zu
ermöglichen. Die Tidy-Data-Prinzipien wurden von Hadley Wickham, dem
Schöpfer von Tidyverse, definiert und beziehen sich auf eine bestimmte
Strukturierung von Daten, die in der Regel aus drei Schlüsselelementen
besteht:</p>
<ol style="list-style-type: decimal">
<li>Jede Variable hat eine Spalte: Jede Variable, die in den Daten
erfasst wird, sollte in einer separaten Spalte aufgeführt werden. Zum
Beispiel sollten Alter, Geschlecht und Einkommen jeweils ihre eigene
Spalte in den Daten haben.</li>
<li>Jeder Beobachtung hat eine Zeile: Jede Beobachtung, die in den Daten
erfasst wird, sollte in einer separaten Zeile aufgeführt werden. Zum
Beispiel sollte jede Person oder jeder Kunde eine eigene Zeile in den
Daten haben.</li>
<li>Jeder Wert hat eine Zelle: Jeder Wert in den Daten sollte in einer
einzelnen Zelle aufgeführt werden. Es sollten keine Zellen geben, die
mehrere Werte enthalten oder Zellen, die leer sind.</li>
</ol>
<p>Die Strukturierung von Daten nach diesen Prinzipien erleichtert es
den Benutzern, Daten effektiver zu manipulieren, zu transformieren, zu
visualisieren und zu analysieren. Tidy data sind auch leichter zu
verstehen und zu kommunizieren, da die Daten in einer klaren und
standardisierten Form dargestellt werden. Die Verwendung von tidy data
ist ein wichtiger Bestandteil von Tidyverse und wird von vielen
Data-Science-Experten und -Praktikern empfohlen.</p>
<div class="figure">
<img
src="https://github.com/allisonhorst/stats-illustrations/raw/main/rstats-artwork/tidydata_1.jpg"
style="width:80.0%" alt="" />
<p class="caption">Artwork by Allison Horst on tidy data</p>
</div>
<hr />
</div>
</div>
<div id="grundlagen-datawrangling-mit-dplyr" class="section level1">
<h1>Grundlagen: Datawrangling mit dplyr</h1>
<p>In diesem Kapitel geht es um das Paket dplyr, was ein unerlässlicher
Bestandteil vom tidyverse ist. Wir werden die wichtigsten Ideen anhand
von Daten aus dem Paket nycflights13 veranschaulichen.</p>
<div id="voraussetzungen" class="section level2">
<h2>Voraussetzungen</h2>
<p>Somit müssen wir als erstes das tidyverse und den Datensatz
laden.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># wird normalerweis automatisch ausgegeben</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># tidyverse_conflicts()</span></span></code></pre></div>
<p>Achtet hierbei auf die automatisch erscheinende Konfliktmeldung, wenn
tidyverse geladen wird. Diese zeigt an, dass dplyr einige Funktionen von
Base R überschreibt. Wenn du nach dem Laden von dplyr die Basisversion
dieser Funktionen verwenden möchtest, musst du ihre vollständigen Namen
angeben: <code>stats::filter()</code> und <code>stats::lag()</code>. Bis
jetzt haben wir meistens nicht beachtet, aus welchem Paket eine Funktion
stammt, da es in der Regel keine Rolle spielt. Wenn du jedoch genau
wissen musst, aus welchem Paket eine Funktion stammt, verwendest du die
gleiche Syntax wie in R: <code>Paketname::Funktionsname()</code>.</p>
<p>Um die grundlegenden dplyr-Verben zu erkunden, werden wir
nycflights13::flights verwenden. Dieser Datensatz enthält alle 336.776
Flüge, die 2013 von New York City abgeflogen sind. Die Daten stammen vom
US Bureau of Transportation Statistics und sind in <code>?flights</code>
dokumentiert. Dieser Datensatz wir häufig für die Einführung in dplyr
verwendet. Bei Problemen findet man somit fast immer eine Lösung.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>flights</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 336,766 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Flights ist eine Tabelle, eine besondere Art von dataframe, die von
Tidyverse verwendet wird, um einige häufige Probleme zu vermeiden. Der
wichtigste Unterschied zwischen Tibbles und klassischen dataframes liegt
darin, wie Tibbles ausgegeben werden. Sie sind für große Datensätze
konzipiert, daher werden nur die ersten wenigen Zeilen und nur die
Spalten angezeigt, die auf einem Bildschirm passen. Es gibt einige
Optionen, um alles zu sehen. Wenn du RStudio verwendest, ist die
bequemste wahrscheinlich <code>View(flights)</code>, die eine
interaktive, scrollbare und filterbare Ansicht öffnet. Ansonsten kannst
du <code>print(flights, width = Inf)</code> verwenden, um alle Spalten
anzuzeigen, oder <code>glimpse()</code> verwenden:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(flights)</span></code></pre></div>
<pre><code>## Rows: 336,776
## Columns: 19
## $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 201…
## $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, 558, 558, 558, 559, 559, 559, 600, 600, 601, 602, 602, 606, 606, 607, 608,…
## $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, 600, 600, 600, 600, 559, 600, 600, 600, 600, 610, 605, 610, 610, 607, 600,…
## $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1, 0, -1, 0, 0, 1, -8, -3, -4, -4, 0, 8, 11, 3, 0, 0, -8, 13, -4, -6, -6, -…
## $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849, 853, 924, 923, 941, 702, 854, 851, 837, 844, 812, 821, 858, 837, 858, 807…
## $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851, 856, 917, 937, 910, 706, 902, 858, 825, 850, 820, 805, 910, 845, 915, 735…
## $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -14, 31, -4, -8, -7, 12, -6, -8, 16, -12, -8, -17, 32, 14, 4, -21, -9, 3, 5,…
## $ carrier        &lt;chr&gt; &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;, &quot;DL&quot;, &quot;UA&quot;, &quot;B6&quot;, &quot;EV&quot;, &quot;B6&quot;, &quot;AA&quot;, &quot;B6&quot;, &quot;B6&quot;, &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;, &quot;UA&quot;, &quot;B6&quot;, &quot;MQ&quot;, &quot;B6&quot;, &quot;DL&quot;, &quot;MQ…
## $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 49, 71, 194, 1124, 707, 1806, 1187, 371, 4650, 343, 1919, 4401, 1895, 1743,…
## $ tailnum        &lt;chr&gt; &quot;N14228&quot;, &quot;N24211&quot;, &quot;N619AA&quot;, &quot;N804JB&quot;, &quot;N668DN&quot;, &quot;N39463&quot;, &quot;N516JB&quot;, &quot;N829AS&quot;, &quot;N593JB&quot;, &quot;N3ALAA&quot;, &quot;N793JB&quot;, &quot;N657JB&quot;, &quot;N29129&quot;,…
## $ origin         &lt;chr&gt; &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;JFK&quot;, &quot;LGA&quot;, &quot;EWR&quot;, &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;JFK&quot;, &quot;JFK&quot;, &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;EWR&quot;, &quot;LGA&quot;, &quot;LG…
## $ dest           &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;MIA&quot;, &quot;BQN&quot;, &quot;ATL&quot;, &quot;ORD&quot;, &quot;FLL&quot;, &quot;IAD&quot;, &quot;MCO&quot;, &quot;ORD&quot;, &quot;PBI&quot;, &quot;TPA&quot;, &quot;LAX&quot;, &quot;SFO&quot;, &quot;DFW&quot;, &quot;BOS&quot;, &quot;LAS&quot;, &quot;FLL&quot;, &quot;AT…
## $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 158, 345, 361, 257, 44, 337, 152, 134, 147, 170, 105, 152, 128, 157, 139, 3…
## $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, 1028, 1005, 2475, 2565, 1389, 187, 2227, 1076, 762, 1023, 1020, 502, 1085,…
## $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, …
## $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0, 0, 0, 0, 10, 5, 10, 10, 7, 0, 0, 10, 15, 15, 30, 10, 27, 30, 30, 30, 30,…
## $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 06:00:00, 2013-01-01 05:00:00, 20…</code></pre>
<p>In beiden Ansichten werden den Variablennamen Abkürzungen angehängt,
die dir den Typ jeder Variablen mitteilen: <int> steht für Ganzzahl,
<dbl> steht für Double (auch als reelle Zahlen bekannt). <int> ist eine
Abkürzung für “integer” und bezeichnet ganze Zahlen ohne
Nachkommastellen, wie zum Beispiel -1, 0 oder 42. <dbl> hingegen ist
eine Abkürzung für “double” und bezeichnet Fließkommazahlen mit
Nachkommastellen, wie zum Beispiel -1.23, 3.14159 oder 1000.0. Im
Allgemeinen benötigen Berechnungen mit Fließkommazahlen (dbl) mehr
Rechenleistung und Speicherplatz als Berechnungen mit ganzen Zahlen
(int). Das <chr> steht für Zeichenfolge (auch als Strings bekannt) und
<dttm> steht für Datum und Uhrzeit. Diese Informationen sind wichtig, da
die Operationen, die du auf einer Spalte durchführen kannst, stark vom
“Typ” abhängen.</p>
</div>
<div id="basics" class="section level2">
<h2>Basics</h2>
<p>Du wirst gleich die wichtigsten dplyr Verben (Funktionen) lernen, mit
denen du die meisten deiner Datenaufbereitungs-Herausforderungen
bewältigen kannst. Bevor wir jedoch auf ihre individuellen Unterschiede
eingehen, ist es wichtig zu erwähnen, was sie gemeinsam haben:</p>
<ol style="list-style-type: decimal">
<li>Das erste Argument ist immer ein dataframe</li>
<li>Die folgenden Argumente beschreiben in der Regel, auf welche Spalten
die Operationen angewendet werden sollen, indem sie die Variablennamen
(ohne Anführungszeichen) verwenden.</li>
<li>Das Ergebnis ist immer ein neuer dataframe</li>
</ol>
<p>Da jedes Verb eine Sache gut macht, erfordert die Lösung komplexer
Probleme normalerweise die Kombination mehrerer Verben, und wir werden
dies mit dem Pipe-Operator %&gt;% tun. Kurz gesagt: der Pipe-Operator
nimmt das, was links von ihm steht, und leitet es an die Funktion rechts
davon weiter, so dass x %&gt;% f(y) äquivalent zu f(x, y) ist und x
%&gt;% f(y) %&gt;% g(z) äquivalent zu g(f(x, y), z) ist. Der einfachste
Weg, den Pipe-Operator auszusprechen, ist “dann”. Dadurch ist es
möglich, eine Vorstellung von dem folgenden Code zu bekommen, auch wenn
du die Details noch nicht kennst:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dest <span class="sc">==</span> <span class="st">&quot;IAH&quot;</span>)  <span class="sc">%&gt;%</span>  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">arr_delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 365 × 4
## # Groups:   year, month [12]
##     year month   day arr_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
##  1  2013     1     1     17.8 
##  2  2013     1     2      7   
##  3  2013     1     3     18.3 
##  4  2013     1     4     -3.2 
##  5  2013     1     5     20.2 
##  6  2013     1     6      9.28
##  7  2013     1     7     -7.74
##  8  2013     1     8      7.79
##  9  2013     1     9     18.1 
## 10  2013     1    10      6.68
## # ℹ 355 more rows</code></pre>
<p>Der Code filtert die Flüge, die nach “IAH” (Houston Intercontinental
Airport) gehen, gruppiert <strong>dann</strong> die verbleibenden Flüge
nach Jahr, Monat und Tag und berechnet <strong>dann</strong> den
durchschnittlichen Ankunftsverspätung (“arr_delay”) pro Gruppe. Daher
gibt der Code eine Tabelle zurück, die die durchschnittlichen
Ankunftsverspätungen für jeden Tag, Monat und Jahr enthält, an dem Flüge
am Houston Intercontinental Airport (IAH) ankamen.</p>
</div>
<div id="zeilen" class="section level2">
<h2>Zeilen</h2>
<p>Die wichtigsten Verben, die auf Zeilen eines Datensatzes wirken, sind
<code>filter()</code>, das eine bestimmte Auswahl an Zeilen anzeigt,
ohne ihre Reihenfolge zu ändern, und <code>arrange()</code>, das die
Reihenfolge der Zeilen anzeigt, ohne die vorhandenen Zeilen zu ändern.
Beide Funktionen wirken sich nur auf die Zeilen aus, während die Spalten
unverändert bleiben. Wir werden auch <code>distinct()</code> besprechen,
das Zeilen mit eindeutigen Werten findet, aber im Gegensatz zu
<code>arrange()</code> und <code>filter()</code> kann es optional auch
die Spalten ändern.</p>
<div id="filter" class="section level3">
<h3><code>filter()</code></h3>
<p><code>filter()</code> extrahiert nur die Zeilen aus einem Datensatz,
die bestimmten Bedingungen entsprechen. Diese Bedingungen können
logische Operationen oder Funktionen enthalten, die auf bestimmte
Spalten angewendet werden. Es werden auch mehrere Bedingungen
akzeptiert.</p>
<div class="figure">
<img
src="https://github.com/allisonhorst/stats-illustrations/raw/main/rstats-artwork/dplyr_filter.jpg"
style="width:80.0%" alt="" />
<p class="caption">Artwork by Allison Horst on filter() function</p>
</div>
<p>Das erste Argument ist wie immer der dataframe. Das zweite und die
folgenden Argumente sind die Bedingungen, die erfüllt sein müssen. Zum
Beispiel könnten wir alle Flüge finden, die mit mehr als 240 Minuten
(vier Stunden) Verspätung abgeflogen sind:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dep_delay <span class="sc">&gt;</span> <span class="dv">240</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1,524 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      848           1835       853     1001           1950       851 MQ        3944 N942MQ  JFK    BWI         41      184    18
##  2  2013     1     1     1815           1325       290     2120           1542       338 EV        4417 N17185  EWR    OMA        213     1134    13
##  3  2013     1     1     1842           1422       260     1958           1535       263 EV        4633 N18120  EWR    BTV         46      266    14
##  4  2013     1     1     2115           1700       255     2330           1920       250 9E        3347 N924XJ  JFK    CVG        115      589    17
##  5  2013     1     1     2205           1720       285       46           2040       246 AA        1999 N5DNAA  EWR    MIA        146     1085    17
##  6  2013     1     1     2343           1724       379      314           1938       456 EV        4321 N21197  EWR    MCI        222     1092    17
##  7  2013     1     2     1332            904       268     1616           1128       288 EV        4364 N41104  EWR    MCI        203     1092     9
##  8  2013     1     2     1412            838       334     1710           1147       323 UA         468 N474UA  EWR    MCO        150      937     8
##  9  2013     1     2     1607           1030       337     2003           1355       368 AA         179 N324AA  JFK    SFO        346     2586    10
## 10  2013     1     2     2131           1512       379     2340           1741       359 UA         488 N593UA  LGA    DEN        228     1620    15
## # ℹ 1,514 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Neben &gt; (größer als) können Sie auch &gt;= (größer als oder
gleich), &lt; (kleiner als), &lt;= (kleiner als oder gleich), ==
(gleich) und != (nicht gleich) verwenden. Sie können Bedingungen auch
mit &amp; oder , kombinieren, um “und” (beide Bedingungen) oder mit |
(eine der beiden Bedingungen) zu kennzeichnen. Allgemein kennt R
verschiedene logische Operatoren, die in der Programmierung verwendet
werden können, um Bedingungen zu verknüpfen Hier sind die wichtigsten
logischen Operatoren in R:</p>
<ul>
<li><code>!</code> (Negation): Dieser Operator wird verwendet, um den
logischen Wert einer Aussage umzukehren. Zum Beispiel gibt !TRUE den
Wert FALSE zurück und umgekehrt.</li>
<li><code>&amp;</code> (UND): Dieser Operator gibt TRUE zurück, wenn
beide Bedingungen, die links und rechts von ihm stehen, TRUE sind.
Ansonsten gibt er FALSE zurück.</li>
<li><code>|</code> (ODER): Dieser Operator gibt TRUE zurück, wenn
mindestens eine der beiden Bedingungen, die links und rechts von ihm
stehen, TRUE ist. Ansonsten gibt er FALSE zurück.</li>
</ul>
<p>Dann gibt es noch Kurzschluss-UND und -ODER. Diese funktionieren
ähnlich wie UND und ODER, aber sie evaluieren Bedingungen auf eine etwas
andere Art und Weise. Kurzschluss-UND und -ODER sind nützlich, wenn man
Bedingungen hat, die zeitaufwendig sind, und man nicht beide Bedingungen
auswerten muss, um die Entscheidung zu treffen.</p>
<ul>
<li><code>&amp;&amp;</code> (Kurzschluss-UND): Dieser Operator evaluiert
die linke Bedingung zuerst und nur wenn diese TRUE ist, wird die rechte
Bedingung ausgewertet. Wenn die linke Bedingung FALSE ist, wird die
rechte Bedingung nicht ausgewertet.</li>
<li><code>||</code> (Kurzschluss-ODER): Dieser Operator funktioniert
analog und gibt nur dann TRUE zurück, wenn mindestens eine der beiden
Bedingungen TRUE ist und die linke Bedingung nicht TRUE auswertet.</li>
</ul>
<p>Aber zurück zu unserem Datensatz. Wenn nach Tag <strong>und</strong>
Monat gefiltert werden soll, müssen nur die beiden Bedingungen mit einem
<code>,</code> oder <code>&amp;</code> verknüpft werden. Gleiches gilt
für den ODER-Operator.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Flüge am 1. Januar</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> day <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 842 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 832 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># oder</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Flüge am 1. Januar</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">1</span>, day <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 842 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 832 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Flüge im Januar oder Febraur</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> month <span class="sc">==</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 51,955 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 51,945 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Es gibt eine nützliche Abkürzung, wenn du <code>|</code>
und<code>==</code> kombinieren willst: <code>%in%</code>. Damit bleiben
Zeilen erhalten, in denen die Variable einem der Werte auf der rechten
Seite entspricht:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ein kürzerer Weg zur Auswahl von Flügen, die im Januar oder Februar abfliegen</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## # A tibble: 51,955 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 51,945 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Durch <code>filter()</code> wird der dataframe nicht überschrieben,
sondern nur die Auswahl in der Konsole ausgegeben. Um das Ergebnis zu
speichern, musst den Zuweisungsoperator <code>&lt;-</code> verwenden.
Das geht am Anfang oder am Ende, dann aber ander herum:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>jan1 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> day <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> day <span class="sc">==</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> jan1</span></code></pre></div>
</div>
<div id="arrange" class="section level3">
<h3><code>arrange()</code></h3>
<p>Mit <code>arrange()</code> können diue Daten in einem dataframe nach
einer oder mehreren Spalten sortiert werden. Es benötigt einen dataframe
und eine Reihe von Spaltennamen (oder kompliziertere Ausdrücke), nach
denen geordnet werden soll. Wenn Sie mehr als einen Spaltennamen
angeben, wird jede zusätzliche Spalte verwendet, um Übereinstimmungen in
den Werten der vorangegangenen Spalten aufzudröseln. Der folgende Code
sortiert zum Beispiel nach der Abflugzeit, die auf vier Spalten verteilt
ist. Wir erhalten zuerst die frühesten Jahre, dann innerhalb eines
Jahres die frühesten Monate, usw.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, month, day, dep_time)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 336,766 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Du kannsz <code>desc()</code> für eine Spalte innerhalb von
<code>arrange()</code> verwenden, um den dataframe auf der Grundlage
dieser Spalte in absteigender Reihenfolge (von groß nach klein) neu zu
ordnen. Zum Beispiel ordnet dieser Code die Flüge von der größten bis
zur geringsten Verspätung:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(dep_delay))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     9      641            900      1301     1242           1530      1272 HA          51 N384HA  JFK    HNL        640     4983     9
##  2  2013     6    15     1432           1935      1137     1607           2120      1127 MQ        3535 N504MQ  JFK    CMH         74      483    19
##  3  2013     1    10     1121           1635      1126     1239           1810      1109 MQ        3695 N517MQ  EWR    ORD        111      719    16
##  4  2013     9    20     1139           1845      1014     1457           2210      1007 AA         177 N338AA  JFK    SFO        354     2586    18
##  5  2013     7    22      845           1600      1005     1044           1815       989 MQ        3075 N665MQ  JFK    CVG         96      589    16
##  6  2013     4    10     1100           1900       960     1342           2211       931 DL        2391 N959DL  JFK    TPA        139     1005    19
##  7  2013     3    17     2321            810       911      135           1020       915 DL        2119 N927DA  LGA    MSP        167     1020     8
##  8  2013     6    27      959           1900       899     1236           2226       850 DL        2007 N3762Y  JFK    PDX        313     2454    19
##  9  2013     7    22     2257            759       898      121           1026       895 DL        2047 N6716C  LGA    ATL        109      762     7
## 10  2013    12     5      756           1700       896     1058           2020       878 AA         172 N5DMAA  EWR    MIA        149     1085    17
## # ℹ 336,766 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Die Anzahl der Zeilen ändert sich dabei nicht, da nicht gefiltert
wird.</p>
</div>
<div id="distinct" class="section level3">
<h3><code>distinct()</code></h3>
<p><code>distinct()</code> findet alle eindeutigen Zeilen in einem
Datensatz. Technisch gesehen werden also in erster Linie die Zeilen
bearbeitet. In den meisten Fällen wirst du jedoch die eindeutige
Kombination einiger Variablen benötigen, weshalb optional auch
Spaltennamen angegeben werden können:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Doppelte Zeilen entfernen, falls vorhanden</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>flights  <span class="sc">%&gt;%</span>  </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 336,766 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alle eindeutigen Herkunfts- und Zielpaare finden</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>flights  <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(origin, dest)</span></code></pre></div>
<pre><code>## # A tibble: 224 × 2
##    origin dest 
##    &lt;chr&gt;  &lt;chr&gt;
##  1 EWR    IAH  
##  2 LGA    IAH  
##  3 JFK    MIA  
##  4 JFK    BQN  
##  5 LGA    ATL  
##  6 EWR    ORD  
##  7 EWR    FLL  
##  8 LGA    IAD  
##  9 JFK    MCO  
## 10 LGA    ORD  
## # ℹ 214 more rows</code></pre>
<p>Wenn du beim Filtern nach eindeutigen Zeilen auch andere Spalten
beibehalten willst, kannst du alternativ die Option
<code>.keep_all = TRUE</code> verwenden.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>flights  <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(origin, dest, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 224 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 214 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Es ist kein Zufall, dass alle diese eindeutigen Flüge am 1. Januar
stattfinden: <code>distinct()</code> findet das erste Vorkommen einer
eindeutigen Zeile im Datensatz und verwirft den Rest.</p>
<p>Wenn du stattdessen die Anzahl der Vorkommen ermitteln willst, ist es
besser, <code>distinct()</code> gegen <code>count()</code>
auszutauschen, und mit dem Argument <code>sort = TRUE</code> kannst du
sie in absteigender Reihenfolge der Anzahl der Vorkommen anordnen.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>flights  <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(origin, dest, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 224 × 3
##    origin dest      n
##    &lt;chr&gt;  &lt;chr&gt; &lt;int&gt;
##  1 JFK    LAX   11262
##  2 LGA    ATL   10263
##  3 LGA    ORD    8857
##  4 JFK    SFO    8204
##  5 LGA    CLT    6168
##  6 EWR    ORD    6100
##  7 JFK    BOS    5898
##  8 LGA    MIA    5781
##  9 JFK    MCO    5464
## 10 EWR    BOS    5327
## # ℹ 214 more rows</code></pre>
</div>
<div id="übung-1" class="section level3">
<h3>Übung 1</h3>
<ol style="list-style-type: decimal">
<li><p>Finde in einer einzelnen Pipeline alle Flüge, die jede der
folgenden Bedingungen erfüllen:</p>
<ul>
<li>Hatten eine Ankunftsverspätung von zwei oder mehr Stunden</li>
<li>Fliegen nach Houston (IAH oder HOU)</li>
<li>Wurden von United, American oder Delta durchgeführt</li>
<li>Sind im Sommer abgeflogen (Juli, August und September)</li>
<li>Sind mehr als zwei Stunden zu spät angekommen, sind aber nicht zu
spät abgeflogen</li>
<li>Waren um mindestens eine Stunde verspätet, haben aber während des
Fluges mehr als 30 Minuten aufgeholt</li>
</ul></li>
<li><p>Sortiere die Flüge, um die Flüge mit den längsten
Abflugverspätungen zu finden. Finde die Flüge, die am frühesten am
Morgen abgeflogen sind.</p></li>
<li><p>Sortiere die Flüge, um die schnellsten Flüge zu finden. (Tipp:
Versuche eine mathematische Berechnung in deiner Funktion zu
verwenden.)</p></li>
<li><p>Welche Flüge sind die weiteste Strecke geflogen? Welche haben die
kürzeste Strecke zurückgelegt?</p></li>
<li><p>Spielt es eine Rolle, in welcher Reihenfolge du filter() und
arrange() verwendest, wenn du beide verwendest? Warum / warum nicht?
Denke über die Ergebnisse und die Arbeit nach, die die Funktionen
leisten müssten.</p></li>
</ol>
</div>
</div>
<div id="spalten" class="section level2">
<h2>Spalten</h2>
<p>Es gibt vier wichtige Verben, die sich auf die Spalten auswirken,
ohne die Zeilen zu verändern: <code>mutate()</code> erzeugt neue
Spalten, die von den vorhandenen Spalten abgeleitet sind,
<code>select()</code> ändert, welche Spalten angezeigt werden,
<code>rename()</code> ändert die Namen der Spalten und
<code>relocate()</code> ändert die Positionen der Spalten.</p>
<div id="mutate" class="section level3">
<h3><code>mutate()</code></h3>
<p>Die Aufgabe von <code>mutate()</code> ist es, neue Spalten
hinzuzufügen, die aus den vorhandenen Spalten berechnet werden. In den
Transformationskapiteln werden Sie eine große Anzahl von Funktionen
kennenlernen, mit denen Sie verschiedene Arten von Variablen
manipulieren können.</p>
<div class="figure">
<img
src="https://github.com/allisonhorst/stats-illustrations/raw/main/rstats-artwork/dplyr_mutate.png"
style="width:80.0%" alt="" />
<p class="caption">Artwork by Allison Horst on mutate() function</p>
</div>
<p>Für den Moment bleiben wir bei der grundlegenden Algebra, die es uns
ermöglicht, den Gewinn, die Zeit, die ein verspäteter Flug in der Luft
verbracht hat, und die Geschwindigkeit in Meilen pro Stunde zu
berechnen:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span>  </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">gain =</span> dep_delay <span class="sc">-</span> arr_delay,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed =</span> distance <span class="sc">/</span> air_time <span class="sc">*</span> <span class="dv">60</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 21
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 336,766 more rows
## # ℹ 4 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, gain &lt;dbl&gt;, speed &lt;dbl&gt;</code></pre>
<p>Standardmäßig fügt <code>mutate()</code> neue Spalten auf der rechten
Seite des Datensatzes hinzu, was es schwierig macht zu sehen, was hier
passiert. Wir können das Argument .before verwenden, um die Variablen
stattdessen auf der linken Seite hinzuzufügen</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">gain =</span> dep_delay <span class="sc">-</span> arr_delay,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed =</span> distance <span class="sc">/</span> air_time <span class="sc">*</span> <span class="dv">60</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 21
##     gain speed  year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance
##    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1    -9  370.  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400
##  2   -16  374.  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416
##  3   -31  408.  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089
##  4    17  517.  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576
##  5    19  394.  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762
##  6   -16  288.  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719
##  7   -24  404.  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065
##  8    11  259.  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229
##  9     5  405.  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944
## 10   -10  319.  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733
## # ℹ 336,766 more rows
## # ℹ 3 more variables: hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Das . ist ein Zeichen dafür, dass .before ein Argument für die
Funktion ist und nicht der Name einer dritten neuen Variablen, die wir
erstellen. Du kannst auch .after verwenden, um nach einer Variablen
hinzuzufügen, und sowohl in .before als auch in .after kannst du den
Variablennamen anstelle einer Position verwenden. Zum Beispiel könnten
wir die neuen Variablen nach dem Tag einfügen:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">gain =</span> dep_delay <span class="sc">-</span> arr_delay,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">speed =</span> distance <span class="sc">/</span> air_time <span class="sc">*</span> <span class="dv">60</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.after =</span> day</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 21
##     year month   day  gain speed dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1    -9  370.      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400
##  2  2013     1     1   -16  374.      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416
##  3  2013     1     1   -31  408.      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089
##  4  2013     1     1    17  517.      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576
##  5  2013     1     1    19  394.      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762
##  6  2013     1     1   -16  288.      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719
##  7  2013     1     1   -24  404.      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065
##  8  2013     1     1    11  259.      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229
##  9  2013     1     1     5  405.      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944
## 10  2013     1     1   -10  319.      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733
## # ℹ 336,766 more rows
## # ℹ 3 more variables: hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Alternativ kannst du mit dem Argument .keep steuern, welche Variablen
beibehalten werden. Ein besonders nützliches Argument ist “used”, das
angibt, dass nur die Spalten beibehalten werden sollen, die am
mutate()-Schritt beteiligt waren oder erstellt wurden. Die folgende
Ausgabe enthält zum Beispiel nur die Variablen dep_delay, arr_delay,
air_time, gain, hours und gain_per_hour.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>flights  <span class="sc">%&gt;%</span>  </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">gain =</span> dep_delay <span class="sc">-</span> arr_delay,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hours =</span> air_time <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gain_per_hour =</span> gain <span class="sc">/</span> hours,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.keep =</span> <span class="st">&quot;used&quot;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 6
##    dep_delay arr_delay air_time  gain hours gain_per_hour
##        &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1         2        11      227    -9 3.78          -2.38
##  2         4        20      227   -16 3.78          -4.23
##  3         2        33      160   -31 2.67         -11.6 
##  4        -1       -18      183    17 3.05           5.57
##  5        -6       -25      116    19 1.93           9.83
##  6        -4        12      150   -16 2.5           -6.4 
##  7        -5        19      158   -24 2.63          -9.11
##  8        -3       -14       53    11 0.883         12.5 
##  9        -3        -8      140     5 2.33           2.14
## 10        -2         8      138   -10 2.3           -4.35
## # ℹ 336,766 more rows</code></pre>
<p>Da wir das Ergebnis der obigen Berechnung nicht den Flügen zugewiesen
haben, werden die neuen Variablen gain, hours und gain_per_hour nur
gedruckt, aber nicht in einem Datensatz gespeichert. Und wenn wir
wollen, dass sie in einem Datensatz für die künftige Verwendung zur
Verfügung stehen, sollten wir uns genau überlegen, ob wir das Ergebnis
wieder Flügen zuweisen und den ursprünglichen Datensatz mit vielen
weiteren Variablen überschreiben oder einem neuen Objekt. Oft ist die
richtige Antwort ein neues Objekt, das informativ benannt wird, um
seinen Inhalt anzugeben, z. B. delay_gain, aber Sie könnten auch gute
Gründe haben, flights zu überschreiben.</p>
</div>
<div id="select" class="section level3">
<h3><code>select()</code></h3>
<p>Es ist nicht ungewöhnlich, Datensätze mit Hunderten oder sogar
Tausenden von Variablen zu erhalten. In dieser Situation besteht die
erste Herausforderung oft darin, sich auf die interessanten Variablen zu
konzentrieren. <code>select()</code> ermöglicht es, schnell auf eine
nützliche Teilmenge zuzugreifen, indem Operationen verwendet werden, die
auf den Namen der Variablen basieren:</p>
<ul>
<li>Wähle Spalten nach Name aus:</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, month, day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ℹ 336,766 more rows</code></pre>
<ul>
<li>Wähle alle Spalten außer den angegebenen:</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(year, month, day))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour minute
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5     15
##  2      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5     29
##  3      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5     40
##  4      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5     45
##  5      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6      0
##  6      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5     58
##  7      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6      0
##  8      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6      0
##  9      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6      0
## 10      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6      0
## # ℹ 336,766 more rows
## # ℹ 1 more variable: time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>Wähle alle Spalten zwischen year und day (einschließlich) aus:</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year<span class="sc">:</span>day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ℹ 336,766 more rows</code></pre>
<ul>
<li>Wählen Sie alle Spalten aus, außer denen von year bis day
(einschließlich):</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>flights  <span class="sc">%&gt;%</span>  </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>year<span class="sc">:</span>day)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour minute
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5     15
##  2      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5     29
##  3      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5     40
##  4      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5     45
##  5      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6      0
##  6      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5     58
##  7      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6      0
##  8      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6      0
##  9      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6      0
## 10      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6      0
## # ℹ 336,766 more rows
## # ℹ 1 more variable: time_hour &lt;dttm&gt;</code></pre>
<p>Du kannst auch <code>-</code> anstelle von <code>!</code> verwenden;
Hadley Wickham empfiehlt !, weil es als “nicht” gelesen wird und sich
gut mit <code>&amp;</code> und <code>|</code> kombinieren lässt.</p>
<ul>
<li>Wähle alle Spalten aus, die Zeichenketten sind:</li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.character))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 4
##    carrier tailnum origin dest 
##    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
##  1 UA      N14228  EWR    IAH  
##  2 UA      N24211  LGA    IAH  
##  3 AA      N619AA  JFK    MIA  
##  4 B6      N804JB  JFK    BQN  
##  5 DL      N668DN  LGA    ATL  
##  6 UA      N39463  EWR    ORD  
##  7 B6      N516JB  EWR    FLL  
##  8 EV      N829AS  LGA    IAD  
##  9 B6      N593JB  JFK    MCO  
## 10 AA      N3ALAA  LGA    ORD  
## # ℹ 336,766 more rows</code></pre>
<p>Es gibt eine Reihe von Hilfsfunktionen, die du in
<code>select()</code> verwenden kannst: -
<code>starts_with("abc")</code>: passt Namen an, die mit “abc” beginnen.
- <code>ends_with("xyz")</code>: passt Namen an, die mit “xyz” enden. -
<code>contains("ijk")</code>: passt Namen an, die “ijk” enthalten. -
<code>matches()</code>: Entspricht einer regular expression. -
<code>num_range("x", 1:3)</code>: passt zu x1, x2 und x3.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>storms <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;dep&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 19,066 × 0</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>storms <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;time&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 19,066 × 0</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>storms <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;_&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 19,066 × 2
##    tropicalstorm_force_diameter hurricane_force_diameter
##                           &lt;int&gt;                    &lt;int&gt;
##  1                           NA                       NA
##  2                           NA                       NA
##  3                           NA                       NA
##  4                           NA                       NA
##  5                           NA                       NA
##  6                           NA                       NA
##  7                           NA                       NA
##  8                           NA                       NA
##  9                           NA                       NA
## 10                           NA                       NA
## # ℹ 19,056 more rows</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># genau vier beliebige Zeichen</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>storms <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;^.{4}$&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 19,066 × 5
##    name   year  hour  long  wind
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
##  1 Amy    1975     0 -79      25
##  2 Amy    1975     6 -79      25
##  3 Amy    1975    12 -79      25
##  4 Amy    1975    18 -79      25
##  5 Amy    1975     0 -78.8    25
##  6 Amy    1975     6 -78.7    25
##  7 Amy    1975    12 -78      25
##  8 Amy    1975    18 -77      30
##  9 Amy    1975     0 -75.8    35
## 10 Amy    1975     6 -74.8    40
## # ℹ 19,056 more rows</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># für dieses Beispiel braucht es einen anderen Datensatz</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>billboard</span></code></pre></div>
<pre><code>## # A tibble: 317 × 79
##    artist track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8   wk9  wk10  wk11  wk12  wk13  wk14  wk15  wk16  wk17  wk18  wk19  wk20  wk21
##    &lt;chr&gt;  &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac  Baby… 2000-02-26      87    82    72    77    87    94    99    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  2 2Ge+h… The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  3 3 Doo… Kryp… 2000-04-08      81    70    68    67    66    57    54    53    51    51    51    51    47    44    38    28    22    18    18    14    12
##  4 3 Doo… Loser 2000-10-21      76    76    72    69    67    65    55    59    62    61    61    59    61    66    72    76    75    67    73    70    NA
##  5 504 B… Wobb… 2000-04-15      57    34    25    17    17    31    36    49    53    57    64    70    75    76    78    85    92    96    NA    NA    NA
##  6 98^0   Give… 2000-08-19      51    39    34    26    26    19     2     2     3     6     7    22    29    36    47    67    66    84    93    94    NA
##  7 A*Tee… Danc… 2000-07-08      97    97    96    95   100    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  8 Aaliy… I Do… 2000-01-29      84    62    51    41    38    35    35    38    38    36    37    37    38    49    61    63    62    67    83    86    NA
##  9 Aaliy… Try … 2000-03-18      59    53    38    28    21    18    16    14    12    10     9     8     6     1     2     2     2     2     3     4     5
## 10 Adams… Open… 2000-08-26      76    76    74    69    68    67    61    58    57    59    66    68    61    67    59    63    67    71    79    89    NA
## # ℹ 307 more rows
## # ℹ 55 more variables: wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;,
## #   wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;,
## #   wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, wk49 &lt;dbl&gt;, wk50 &lt;dbl&gt;, wk51 &lt;dbl&gt;, wk52 &lt;dbl&gt;, wk53 &lt;dbl&gt;, wk54 &lt;dbl&gt;, wk55 &lt;dbl&gt;,
## #   wk56 &lt;dbl&gt;, wk57 &lt;dbl&gt;, wk58 &lt;dbl&gt;, wk59 &lt;dbl&gt;, wk60 &lt;dbl&gt;, wk61 &lt;dbl&gt;, wk62 &lt;dbl&gt;, wk63 &lt;dbl&gt;, wk64 &lt;dbl&gt;, wk65 &lt;dbl&gt;, wk66 &lt;lgl&gt;, wk67 &lt;lgl&gt;,
## #   wk68 &lt;lgl&gt;, wk69 &lt;lgl&gt;, wk70 &lt;lgl&gt;, wk71 &lt;lgl&gt;, wk72 &lt;lgl&gt;, wk73 &lt;lgl&gt;, wk74 &lt;lgl&gt;, wk75 &lt;lgl&gt;, wk76 &lt;lgl&gt;</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">num_range</span>(<span class="st">&quot;wk&quot;</span>, <span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>))</span></code></pre></div>
<pre><code>## # A tibble: 317 × 6
##     wk10  wk11  wk12  wk13  wk14  wk15
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1    NA    NA    NA    NA    NA    NA
##  2    NA    NA    NA    NA    NA    NA
##  3    51    51    51    47    44    38
##  4    61    61    59    61    66    72
##  5    57    64    70    75    76    78
##  6     6     7    22    29    36    47
##  7    NA    NA    NA    NA    NA    NA
##  8    36    37    37    38    49    61
##  9    10     9     8     6     1     2
## 10    59    66    68    61    67    59
## # ℹ 307 more rows</code></pre>
<p>Du kannst Variablen während der Auswahl <code>select()</code>
umbenennen, indem du <code>=</code> verwendest. Der neue Name erscheint
auf der linken Seite von <code>=</code>, und die alte Variable erscheint
auf der rechten Seite:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>flights  <span class="sc">%&gt;%</span>  </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">tail_num =</span> tailnum)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 1
##    tail_num
##    &lt;chr&gt;   
##  1 N14228  
##  2 N24211  
##  3 N619AA  
##  4 N804JB  
##  5 N668DN  
##  6 N39463  
##  7 N516JB  
##  8 N829AS  
##  9 N593JB  
## 10 N3ALAA  
## # ℹ 336,766 more rows</code></pre>
</div>
<div id="rename" class="section level3">
<h3><code>rename()</code></h3>
<p>Wenn Sie alle vorhandenen Variablen behalten möchten und nur einige
umbenennen möchten, können Sie anstelle von select() rename()
verwenden:</p>
<p>Wenn du eine Reihe von inkonsistent benannten Spalten haben und es
schmerzhaft wäre, sie alle manuell zu korrigieren, schauen Sie sich
janitor::clean_names() an, das einige nützliche automatisierte
Reinigungsfunktionen bietet.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">tail_num =</span> tailnum)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tail_num origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228   EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211   LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA   JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB   JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN   LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463   EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB   EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS   LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB   JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA   LGA    ORD        138      733     6
## # ℹ 336,766 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="relocate" class="section level3">
<h3><code>relocate()</code></h3>
<p>Verwende <code>relocate()</code>, um Variablen zu verschieben.
Vielleicht möchtest du verwandte Variablen zusammenfassen oder wichtige
Variablen nach vorne verschieben. Standardmäßig verschiebt
<code>relocate()</code> Variablen nach vorne:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(time_hour, air_time)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
##    time_hour           air_time  year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest 
##    &lt;dttm&gt;                 &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
##  1 2013-01-01 05:00:00      227  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH  
##  2 2013-01-01 05:00:00      227  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH  
##  3 2013-01-01 05:00:00      160  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA  
##  4 2013-01-01 05:00:00      183  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN  
##  5 2013-01-01 06:00:00      116  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL  
##  6 2013-01-01 05:00:00      150  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD  
##  7 2013-01-01 06:00:00      158  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL  
##  8 2013-01-01 06:00:00       53  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD  
##  9 2013-01-01 06:00:00      140  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO  
## 10 2013-01-01 06:00:00      138  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD  
## # ℹ 336,766 more rows
## # ℹ 3 more variables: distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;</code></pre>
<p>Du kannst auch angeben, wo sie eingefügt werden sollen, indem du die
Argumente <code>.before</code> und <code>.after</code> verwendest, genau
wie bei <code>mutate()</code>:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(year<span class="sc">:</span>dep_time, <span class="at">.after =</span> time_hour)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
##    sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour minute time_hour            year
##             &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dttm&gt;              &lt;int&gt;
##  1            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5     15 2013-01-01 05:00:00  2013
##  2            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5     29 2013-01-01 05:00:00  2013
##  3            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5     40 2013-01-01 05:00:00  2013
##  4            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5     45 2013-01-01 05:00:00  2013
##  5            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6      0 2013-01-01 06:00:00  2013
##  6            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5     58 2013-01-01 05:00:00  2013
##  7            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6      0 2013-01-01 06:00:00  2013
##  8            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6      0 2013-01-01 06:00:00  2013
##  9            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6      0 2013-01-01 06:00:00  2013
## 10            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6      0 2013-01-01 06:00:00  2013
## # ℹ 336,766 more rows
## # ℹ 3 more variables: month &lt;int&gt;, day &lt;int&gt;, dep_time &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">&quot;arr&quot;</span>), <span class="at">.before =</span> dep_time)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day arr_time arr_delay dep_time sched_dep_time dep_delay sched_arr_time carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;          &lt;int&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      830        11      517            515         2            819 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      850        20      533            529         4            830 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      923        33      542            540         2            850 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1     1004       -18      544            545        -1           1022 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      812       -25      554            600        -6            837 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      740        12      554            558        -4            728 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      913        19      555            600        -5            854 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      709       -14      557            600        -3            723 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      838        -8      557            600        -3            846 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      753         8      558            600        -2            745 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 336,766 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="übung-2" class="section level3">
<h3>Übung 2</h3>
<ol style="list-style-type: decimal">
<li><p>Vergleiche <code>dep_time</code>, <code>sched_dep_time</code>,
und <code>dep_delay</code>. Welchen Zusammenhang erwartest du zwischen
diesen drei Zahlen?</p></li>
<li><p>Überlege dir so viele Möglichkeiten wie möglich, um
<code>dep_time</code>, <code>dep_delay</code>, <code>arr_time</code> und
<code>arr_delay</code> aus <code>flights</code> auszuwählen.</p></li>
<li><p>Was passiert, wenn man den Namen der gleichen Variable mehrmals
in einem <code>select()</code>-Aufruf angibt?</p></li>
<li><p>Was macht die Funktion <code>any_of()</code>?Warum könnte sie in
Verbindung mit diesem Vektor hilfreich sein?</p>
<div class="sourceCode" id="cb71"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>  variables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;dep_delay&quot;</span>, <span class="st">&quot;arr_delay&quot;</span>)</span></code></pre></div></li>
<li><p>Überrascht dich das Ergebnis des folgenden Codes? Wie gehen die
Select-Helfer standardmäßig mit der Groß- und Kleinschreibung um? Wie
kannst du diese Voreinstellung ändern?</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>  flights <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;TIME&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 6
##    dep_time sched_dep_time arr_time sched_arr_time air_time time_hour          
##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt; &lt;dttm&gt;             
##  1      517            515      830            819      227 2013-01-01 05:00:00
##  2      533            529      850            830      227 2013-01-01 05:00:00
##  3      542            540      923            850      160 2013-01-01 05:00:00
##  4      544            545     1004           1022      183 2013-01-01 05:00:00
##  5      554            600      812            837      116 2013-01-01 06:00:00
##  6      554            558      740            728      150 2013-01-01 05:00:00
##  7      555            600      913            854      158 2013-01-01 06:00:00
##  8      557            600      709            723       53 2013-01-01 06:00:00
##  9      557            600      838            846      140 2013-01-01 06:00:00
## 10      558            600      753            745      138 2013-01-01 06:00:00
## # ℹ 336,766 more rows</code></pre></li>
<li><p>Benenne <code>air_time</code> in <code>air_time_min</code> um, um
die Maßeinheiten anzugeben und verschiebe es an den Anfang des
Datensatzes.</p></li>
<li><p>Warum funktioniert das Folgende nicht, und was bedeutet der
Fehler?</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span>  </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tailnum) <span class="sc">%&gt;%</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(arr_delay)</span></code></pre></div>
<pre><code>## Error in `arrange()`:
## ℹ In argument: `..1 = arr_delay`.
## Caused by error:
## ! object &#39;arr_delay&#39; not found</code></pre></li>
</ol>
</div>
</div>
<div id="gruppen" class="section level2">
<h2>Gruppen</h2>
<p>Bisher hast du Funktionen kennengelernt, die mit Zeilen und Spalten
arbeiten. dplyr wird noch mächtiger, wenn du die Möglichkeit hast, mit
Gruppen zu arbeiten. In diesem Abschnitt konzentrieren wir uns auf die
wichtigsten Funktionen: <code>group_by()</code>,
<code>summarize(</code>) und die Slice-Funktionen.</p>
<div id="group_by" class="section level3">
<h3><code>group_by()</code></h3>
<p>Verwende <code>group_by()</code>, um deinen Datensatz in sinnvolle
Gruppen für deine Analyse aufzuteilen:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month)</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
## # Groups:   month [12]
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 336,766 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><code>group_by()</code> verändert die Daten nicht, aber wenn du dir
das Ergebnis genau ansiehst, wirst du bemerken, dass das Ergebnis
anzeigt, dass es “nach Monat gruppiert” ist
(<code>Groups: month [12]</code>). Dies bedeutet, dass nachfolgende
Operationen nun “nach Monat” arbeiten werden. <code>group_by()</code>
fügt dem Datensatz dieses gruppierte Merkmal (auch als Klasse
bezeichnet) hinzu, was das Verhalten der nachfolgenden Verben, die auf
die Daten angewendet werden, ändert.</p>
</div>
<div id="summarize" class="section level3">
<h3><code>summarize()</code></h3>
<p>Die wichtigste gruppierte Operation ist eine Zusammenfassung, die,
wenn sie verwendet wird, um eine einzige Zusammenfassungsstatistik zu
berechnen, den Datensatz auf eine einzige Zeile für jede Gruppe
reduziert. In dplyr wird diese Operation von <code>summarize()</code>
durchgeführt, wie im folgenden Beispiel gezeigt wird, das die
durchschnittliche Abflugsverzögerung pro Monat berechnet:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_delay =</span> <span class="fu">mean</span>(dep_delay)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 12 × 2
##    month avg_delay
##    &lt;int&gt;     &lt;dbl&gt;
##  1     1        NA
##  2     2        NA
##  3     3        NA
##  4     4        NA
##  5     5        NA
##  6     6        NA
##  7     7        NA
##  8     8        NA
##  9     9        NA
## 10    10        NA
## 11    11        NA
## 12    12        NA</code></pre>
<p>Oh nein! Etwas ist schief gelaufen und alle unsere Ergebnisse sind
NAs, das Symbol von R für fehlende Werte. Dies ist passiert, weil bei
einigen der beobachteten Flüge Daten in der Verzögerungsspalte fehlten
und wir deshalb bei der Berechnung des Mittelwerts einschließlich dieser
Werte ein NA-Ergebnis erhalten haben. Wir werden später ausführlich auf
fehlende Werte eingehen, aber jetzt sagen wir der Funktion
<code>mean()</code>, dass sie alle fehlenden Werte ignorieren soll,
indem wir das Argument na.rm auf TRUE setzen:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 12 × 2
##    month delay
##    &lt;int&gt; &lt;dbl&gt;
##  1     1 10.0 
##  2     2 10.8 
##  3     3 13.2 
##  4     4 13.9 
##  5     5 13.0 
##  6     6 20.8 
##  7     7 21.7 
##  8     8 12.6 
##  9     9  6.72
## 10    10  6.24
## 11    11  5.44
## 12    12 16.6</code></pre>
<p>Du kannst in einem einzigen Aufruf von <code>summarize()</code>
beliebig viele Zusammenfassungen erstellen. Du wirst in den kommenden
Kapiteln verschiedene nützliche Zusammenfassungen lernen, aber eine sehr
nützliche Zusammenfassung ist <code>n()</code>, die die Anzahl der
Zeilen in jeder Gruppe zurückgibt:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##    month delay     n
##    &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
##  1     1 10.0  27004
##  2     2 10.8  24951
##  3     3 13.2  28834
##  4     4 13.9  28330
##  5     5 13.0  28796
##  6     6 20.8  28243
##  7     7 21.7  29425
##  8     8 12.6  29327
##  9     9  6.72 27574
## 10    10  6.24 28889
## 11    11  5.44 27268
## 12    12 16.6  28135</code></pre>
<p>Mittelwerte und Zählungen können dich überraschend weit in im Bereich
Data Science bringen!</p>
</div>
<div id="slice_funktionen" class="section level3">
<h3><code>slice_</code>Funktionen</h3>
<p>Es gibt fünf praktische Funktionen, mit denen du spezifische Zeilen
innerhalb jeder Gruppe extrahieren kannst: -
<code>df %&gt;% slice_head(n = 1)</code> nimmt die erste Zeile aus jeder
Gruppe. - <code>df %&gt;% slice_tail(n = 1)</code> nimmt die letzte
Zeile aus jeder Gruppe. - <code>df %&gt;% slice_min(x, n = 1)</code>
nimmt die Zeile mit dem kleinsten Wert der Spalte <code>x</code>. -
<code>df %&gt;% slice_max(x, n = 1)</code> nimmt die Zeile mit dem
größten Wert der Spalte <code>x</code>. -
<code>df %&gt;% slice_sample(n = 1)</code> nimmt eine zufällige
Zeile.</p>
<p>Du kannst <code>n</code> variieren, um mehr als eine Zeile
auszuwählen. Anstelle von <code>n =</code> kannst du auch
<code>prop = 0.</code>1 verwenden, um (z.B.) 10% der Zeilen in jeder
Gruppe auszuwählen. Das folgende Beispiel findet die Flüge, die bei der
Ankunft an jedem Zielort am meisten verspätet sind:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dest) <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(arr_delay, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(dest)</span></code></pre></div>
<pre><code>## # A tibble: 108 × 19
## # Groups:   dest [105]
##    dest   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin air_time distance  hour
##    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1 ABQ    2013     7    22     2145           2007        98      132           2259       153 B6        1505 N784JB  JFK         259     1826    20
##  2 ACK    2013     7    23     1139            800       219     1250            909       221 B6        1491 N192JB  JFK          44      199     8
##  3 ALB    2013     1    25      123           2000       323      229           2101       328 EV        4309 N13908  EWR          30      143    20
##  4 ANC    2013     8    17     1740           1625        75     2042           2003        39 UA         887 N528UA  EWR         404     3370    16
##  5 ATL    2013     7    22     2257            759       898      121           1026       895 DL        2047 N6716C  LGA         109      762     7
##  6 AUS    2013     7    10     2056           1505       351     2347           1758       349 UA         503 N803UA  EWR         192     1504    15
##  7 AVL    2013     8    13     1156            832       204     1417           1029       228 EV        4175 N13538  EWR         108      583     8
##  8 BDL    2013     2    21     1728           1316       252     1839           1413       266 EV        4103 N16976  EWR          26      116    13
##  9 BGR    2013    12     1     1504           1056       248     1628           1230       238 EV        5309 N615QX  LGA          57      378    10
## 10 BHM    2013     4    10       25           1900       325      136           2045       291 EV        5038 N713EV  LGA         115      866    19
## # ℹ 98 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Beachte, dass es hier 108 Zeilen gibt, obwohl es nur 105 Zielorte
gibt. Was ist los? <code>slice_min()</code> und <code>slice_max()</code>
behalten gebundene Werte bei, sodass <code>n = 1</code> bedeutet, dass
uns alle Zeilen mit dem höchsten Wert gegeben werden. Wenn du genau eine
Zeile pro Gruppe haben möchtest, kannst du
<code>with_ties = FALSE</code> setzen.</p>
<p>Dies ist ähnlich wie das Berechnen der maximalen Verspätung mit
<code>summarize()</code>, aber du bekommst die ganze zugehörige Zeile
(oder Zeilen, wenn es eine Bindung gibt), anstatt der einzelnen
Zusammenfassungsstatistik.</p>
</div>
<div id="mehrfaches-gruppieren" class="section level3">
<h3>mehrfaches Gruppieren</h3>
<p>Du kannst Gruppen mit mehr als einer Variable erstellen. Zum Beispiel
könnten wir eine Gruppe für jedes Datum erstellen.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>daily <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span>  </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, day)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>daily</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
## # Groups:   year, month, day [365]
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 336,766 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Wenn du eine tibble zusammenfasst, die nach mehr als einer Variable
gruppiert ist, entfernt jede Zusammenfassung die letzte Gruppe. Laut den
Entwickelnden war dies keine gute Methode, um diese Funktion zu
implementieren. Hier ist es jedoch schwierig, sie zu ändern, ohne
vorhandenen Code zu zerstören. Um zu verdeutlichen, was passiert, zeigt
dplyr eine Nachricht an, die dir sagt, wie du dieses Verhalten ändern
kannst:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>daily_flights <span class="ot">&lt;-</span> daily <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</code></pre>
<p>Wenn du mit diesem Verhalten zufrieden bist, kannst du es explizit
anfordern, um die Nachricht zu unterdrücken:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>daily_flights <span class="ot">&lt;-</span> daily <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop_last&quot;</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Ändere alternativ das Standardverhalten, indem du einen anderen Wert
festlegst, z.B. <code>"drop"</code>, um alle Gruppierungen zu entfernen,
oder <code>"keep"</code>, um dieselben Gruppen beizubehalten.</p>
</div>
<div id="ungroup" class="section level3">
<h3><code>ungroup()</code></h3>
<p>Du möchtest möglicherweise auch die Gruppierung in einem Datensatz
entfernen, ohne s<code>ummarize()</code> zu verwenden. Das kannst du mit
<code>ungroup()</code> tun.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>daily <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 336,766 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Lass uns nun sehen, was passiert, wenn du einen nicht gruppierten
Datensatz zusammenfasst.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>daily <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">flights =</span> <span class="fu">n</span>()</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   avg_delay flights
##       &lt;dbl&gt;   &lt;int&gt;
## 1      12.6  336776</code></pre>
<p>Du erhältst eine einzelne Zeile zurück, weil dplyr alle Zeilen in
einem nicht gruppierten Datensatz als zu einer Gruppe gehörig
behandelt.</p>
</div>
<div id="by" class="section level3">
<h3><code>.by</code></h3>
<p>dplyr 1.1.0 enthält eine neue, experimentelle Syntax für die
Gruppierung pro Operation, das .by-Argument. group_by() und ungroup()
werden nicht verschwinden, aber du kannst jetzt auch das .by-Argument
verwenden, um innerhalb einer einzelnen Operation zu gruppieren:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> month</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##    month delay     n
##    &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
##  1     1 10.0  27004
##  2    10  6.24 28889
##  3    11  5.44 27268
##  4    12 16.6  28135
##  5     2 10.8  24951
##  6     3 13.2  28834
##  7     4 13.9  28330
##  8     5 13.0  28796
##  9     6 20.8  28243
## 10     7 21.7  29425
## 11     8 12.6  29327
## 12     9  6.72 27574</code></pre>
<p>Oder wenn du nach mehreren Variablen gruppieren willst:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>flights  <span class="sc">%&gt;%</span>  </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(origin, dest)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 224 × 4
##    origin dest  delay     n
##    &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;int&gt;
##  1 EWR    IAH   11.8   3973
##  2 LGA    IAH    9.06  2951
##  3 JFK    MIA    9.34  3314
##  4 JFK    BQN    6.67   599
##  5 LGA    ATL   11.4  10263
##  6 EWR    ORD   14.6   6100
##  7 EWR    FLL   13.5   3793
##  8 LGA    IAD   16.7   1803
##  9 JFK    MCO   10.6   5464
## 10 LGA    ORD   10.7   8857
## # ℹ 214 more rows</code></pre>
<p>.by funktioniert mit allen Verben und hat den Vorteil, dass du nicht
das Argument .groups verwenden musst, um die Gruppierungsmeldung zu
unterdrücken oder die Gruppierung aufzuheben, wenn du fertig bist. Du
kannst mehr darüber in dem <a
href="https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-per-operation-grouping/">dplyr
1.1.0 Blog Post</a> erfahren.</p>
</div>
<div id="übung-3" class="section level3">
<h3>Übung 3</h3>
<ol style="list-style-type: decimal">
<li><p>Welcher Anbieter hat die schlechtesten durchschnittlichen
Verspätungen? Herausforderung: Kannst du die Auswirkungen von schlechten
Flughäfen und schlechten Anbietern auseinanderhalten? Warum / warum
nicht? (Tipp: denke darüber nach:
<code>flights %&gt;% group_by(carrier, dest) %&gt;% summarize(n())</code>).</p></li>
<li><p>Finde die Flüge, die bei der Abreise von jedem Zielort am meisten
verspätet sind.</p></li>
<li><p>Wie variieren Verspätungen im Laufe des Tages? Veranschauliche
deine Antwort mit einem Diagramm.</p></li>
<li><p>Was passiert, wenn du slice_min() und Friends eine negative
<code>n</code> lieferst?</p></li>
<li><p>Erkläre, was count() im Hinblick auf die dplyr-Verben tut, die du
gerade gelernt hast. Was macht das sort-Argument von count()?</p></li>
<li><p>Angenommen, wir haben den folgenden winzigen Datensatz:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>),</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">c</span>(<span class="st">&quot;K&quot;</span>, <span class="st">&quot;K&quot;</span>, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;K&quot;</span>)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li><p>Wie wird die Ausgabe aussehen? Hattest du Recht? Beschreibe
zuletzt mit eigenen Worten, was <code>group_by()</code> tut.</p>
<div class="sourceCode" id="cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(y)</span></code></pre></div></li>
<li><p>Wie wird die Ausgabe aussehen? Hattest du Recht? Beschreibe mit
eigenen Worten, was <code>arrange()</code> tut. Kommentiere auch,
inwiefern sich diese Funktion von group_by() in Aufgabe 6a (a)
unterscheidet.</p>
<div class="sourceCode" id="cb101"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(y)</span></code></pre></div></li>
<li><p>Wie wird die Ausgabe aussehen? Hattest du Recht? Beschreibe mit
eigenen Worten, was die pipeline tut.</p>
<div class="sourceCode" id="cb102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(y) <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_x =</span> <span class="fu">mean</span>(x))</span></code></pre></div></li>
<li><p>Wie wird die Ausgabe aussehen? Hattest du Recht? Beschreibe mit
eigenen Worten, was die pipeline tut. Was steht in der Nachricht in der
Konsole?</p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(y, z) <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_x =</span> <span class="fu">mean</span>(x))</span></code></pre></div></li>
<li><p>Wie wird die Ausgabe aussehen? Hattest du Recht? Beschreibe mit
eigenen Worten, was die pipeline tut. Wie unterscheidet sich der Output
von Frage 6d.</p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(y, z) <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_x =</span> <span class="fu">mean</span>(x), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span></code></pre></div></li>
<li><p>Wie wird die Ausgabe aussehen? Hattest du Recht? Beschreibe mit
eigenen Worten, was die pipeline tut. HWie unterscheiden sich die beiden
pipelines?</p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(y, z) <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_x =</span> <span class="fu">mean</span>(x))</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(y, z) <span class="sc">%&gt;%</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_x =</span> <span class="fu">mean</span>(x))</span></code></pre></div></li>
</ol></li>
</ol>
</div>
</div>
</div>
<div id="pivotieren-der-daten" class="section level1">
<h1>Pivotieren der Daten</h1>
<div id="verlängern-der-daten" class="section level2">
<h2>Verlängern der Daten</h2>
<p>Die Prinzipien von tidy data mögen so offensichtlich sein, dass du
dich fragst, ob du jemals auf einen Datensatz treffen wirst, der nicht
sauber ist. Leider sind jedoch die meisten realen Daten nicht sauber. Es
gibt zwei Hauptgründe:</p>
<ol style="list-style-type: decimal">
<li><p>Daten werden oft so organisiert, dass sie ein Ziel außerhalb der
Analyse unterstützen. Zum Beispiel ist es häufig, dass Daten
strukturiert sind, um die Dateneingabe und nicht die Analyse zu
erleichtern.</p></li>
<li><p>Die meisten Menschen sind nicht mit den Prinzipien sauberer Daten
vertraut, und es ist schwierig, sie selbst abzuleiten, es sei denn, du
verbringst viel Zeit mit der Arbeit mit Daten.</p></li>
</ol>
<p>Das bedeutet, dass die meisten echten Analysen zumindest eine kleine
Bereinigung erfordern. Du wirst damit beginnen herauszufinden, welche
zugrunde liegenden Variablen und Beobachtungen vorhanden sind. Manchmal
ist dies einfach; andere Male musst du möglicherweise mit den Personen
sprechen, die die Daten ursprünglich generiert haben. Als Nächstes wirst
du deine Daten in eine saubere Form umwandeln, mit Variablen in den
Spalten und Beobachtungen in den Zeilen.</p>
<p><code>tidyr</code> bietet zwei Funktionen zum Umwandeln von Daten:
<code>pivot_longer()</code> und <code>pivot_wider()</code>. Wir beginnen
zunächst mit <code>pivot_longer()</code>, da dies der häufigste Fall
ist. Lass uns einige Beispiele durchgehen.</p>
<div id="daten-in-spaltennamen" class="section level3">
<h3>Daten in Spaltennamen</h3>
<p>Der Datensatz “billboard” enthält Informationen über die Charts im
Jahr 2000:</p>
<div class="sourceCode" id="cb106"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>billboard</span></code></pre></div>
<pre><code>## # A tibble: 317 × 79
##    artist track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8   wk9  wk10  wk11  wk12  wk13  wk14  wk15  wk16  wk17  wk18  wk19  wk20  wk21
##    &lt;chr&gt;  &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac  Baby… 2000-02-26      87    82    72    77    87    94    99    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  2 2Ge+h… The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  3 3 Doo… Kryp… 2000-04-08      81    70    68    67    66    57    54    53    51    51    51    51    47    44    38    28    22    18    18    14    12
##  4 3 Doo… Loser 2000-10-21      76    76    72    69    67    65    55    59    62    61    61    59    61    66    72    76    75    67    73    70    NA
##  5 504 B… Wobb… 2000-04-15      57    34    25    17    17    31    36    49    53    57    64    70    75    76    78    85    92    96    NA    NA    NA
##  6 98^0   Give… 2000-08-19      51    39    34    26    26    19     2     2     3     6     7    22    29    36    47    67    66    84    93    94    NA
##  7 A*Tee… Danc… 2000-07-08      97    97    96    95   100    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  8 Aaliy… I Do… 2000-01-29      84    62    51    41    38    35    35    38    38    36    37    37    38    49    61    63    62    67    83    86    NA
##  9 Aaliy… Try … 2000-03-18      59    53    38    28    21    18    16    14    12    10     9     8     6     1     2     2     2     2     3     4     5
## 10 Adams… Open… 2000-08-26      76    76    74    69    68    67    61    58    57    59    66    68    61    67    59    63    67    71    79    89    NA
## # ℹ 307 more rows
## # ℹ 55 more variables: wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;,
## #   wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;,
## #   wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, wk49 &lt;dbl&gt;, wk50 &lt;dbl&gt;, wk51 &lt;dbl&gt;, wk52 &lt;dbl&gt;, wk53 &lt;dbl&gt;, wk54 &lt;dbl&gt;, wk55 &lt;dbl&gt;,
## #   wk56 &lt;dbl&gt;, wk57 &lt;dbl&gt;, wk58 &lt;dbl&gt;, wk59 &lt;dbl&gt;, wk60 &lt;dbl&gt;, wk61 &lt;dbl&gt;, wk62 &lt;dbl&gt;, wk63 &lt;dbl&gt;, wk64 &lt;dbl&gt;, wk65 &lt;dbl&gt;, wk66 &lt;lgl&gt;, wk67 &lt;lgl&gt;,
## #   wk68 &lt;lgl&gt;, wk69 &lt;lgl&gt;, wk70 &lt;lgl&gt;, wk71 &lt;lgl&gt;, wk72 &lt;lgl&gt;, wk73 &lt;lgl&gt;, wk74 &lt;lgl&gt;, wk75 &lt;lgl&gt;, wk76 &lt;lgl&gt;</code></pre>
<p>In diesem Datensatz stellt jede Beobachtung einen Song dar. Die
ersten drei Spalten (<code>artist</code>, <code>track</code> und
<code>date.entered</code>) sind Variablen, die den Song beschreiben.
Anschließend haben wir 76 Spalten (<code>wk1</code>-<code>wk76</code>),
die den Rang des Songs in jeder Woche beschreiben. Hierbei stellen die
Spaltennamen eine Variable dar (die <code>week</code>) und die
Zellenwerte eine andere Variable (den <code>rank</code>) dar.</p>
<p>Der Song wird aufgenommen, solange er im Jahr 2000 irgendwann in den
Top 100 war und bis zu 72 Wochen nach seinem Erscheinen verfolgt
wird.</p>
<p>Um diese Daten zu bereinigen, werden wir <code>pivot_longer()</code>
verwenden:</p>
<div class="sourceCode" id="cb108"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span>  </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;wk&quot;</span>), </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;week&quot;</span>, </span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;rank&quot;</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 24,092 × 5
##    artist track                   date.entered week   rank
##    &lt;chr&gt;  &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
##  1 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk1      87
##  2 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk2      82
##  3 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk3      72
##  4 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk4      77
##  5 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk5      87
##  6 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk6      94
##  7 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk7      99
##  8 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk8      NA
##  9 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk9      NA
## 10 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk10     NA
## # ℹ 24,082 more rows</code></pre>
<p>Nach den Daten gibt es drei wichtige Argumente:</p>
<ul>
<li><code>cols</code> gibt an, welche Spalten umgewandelt werden sollen,
d.h. welche Spalten keine Variablen sind. Dieses Argument verwendet die
gleiche Syntax wie <code>select()</code>, daher könnten wir hier
<code>!c(artist, track, date.entered)</code> oder
<code>starts_with("wk")</code> verwenden.</li>
<li><code>names_to</code> benennt die Variable, die in den Spaltennamen
gespeichert wird, wir haben diese Variable “week” genannt.</li>
<li><code>values_to</code> benennt die Variable, die in den Zellenwerten
gespeichert wird, wir haben diese Variable “rank” genannt.</li>
</ul>
<p>Beachte, dass in dem Code “week” und “rank” in Anführungszeichen
gesetzt sind, da dies neue Variablen sind, die wir erstellen. Sie
existieren noch nicht in den Daten, wenn wir den Aufruf von
<code>pivot_longer()</code> ausführen.</p>
<p>Nun wollen wir uns dem resultierenden, längeren Datensatz widmen. Was
passiert, wenn ein Song weniger als 76 Wochen lang in den Top 100 ist?
Nehmen wir zum Beispiel 2 Pac’s “Baby Don’t Cry”. Die obige Ausgabe legt
nahe, dass es nur 7 Wochen lang in den Top 100 war und alle
verbleibenden Wochen mit fehlenden Werten aufgefüllt sind. Diese
<code>NA</code>s repräsentieren nicht wirklich unbekannte Beobachtungen.
Sie wurden durch die Struktur des Datensatzes erzwungen. Daher können
wir <code>pivot_longer()</code> bitten, sie mit
<code>values_drop_na = TRUE</code> zu entfernen:</p>
<div class="sourceCode" id="cb110"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span>  </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;wk&quot;</span>), </span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;week&quot;</span>, </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;rank&quot;</span>,</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_drop_na =</span> <span class="cn">TRUE</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 5,307 × 5
##    artist  track                   date.entered week   rank
##    &lt;chr&gt;   &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
##  1 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk1      87
##  2 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk2      82
##  3 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk3      72
##  4 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk4      77
##  5 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk5      87
##  6 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk6      94
##  7 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk7      99
##  8 2Ge+her The Hardest Part Of ... 2000-09-02   wk1      91
##  9 2Ge+her The Hardest Part Of ... 2000-09-02   wk2      87
## 10 2Ge+her The Hardest Part Of ... 2000-09-02   wk3      92
## # ℹ 5,297 more rows</code></pre>
<p>Die Anzahl der Zeilen ist nun deutlich niedriger, was darauf
hinweist, dass viele Zeilen mit <code>NA</code> entfernt wurden.</p>
<p>Du könntest dich auch fragen, was passiert, wenn ein Song länger als
76 Wochen lang in den Top 100 ist. Aus diesen Daten können wir es nicht
erkennen, aber du könntest vermuten, dass zusätzliche Spalten
<code>wk77</code>, <code>wk78</code>, … zum Datensatz hinzugefügt
würden.</p>
<p>Die Daten sind jetzt sauber, aber wir könnten zukünftige Berechnungen
etwas einfacher machen, indem wir die Werte von <code>week</code> von
Zeichenketten in Zahlen umwandeln, und zwar mithilfe von
<code>mutate()</code> und <code>readr::parse_number()</code>.
<code>parse_number()</code> ist eine praktische Funktion, die die erste
Zahl aus einem String extrahiert und alle anderen Texte ignoriert.</p>
<div class="sourceCode" id="cb112"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>billboard_longer <span class="ot">&lt;-</span> billboard <span class="sc">%&gt;%</span>  </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;wk&quot;</span>), </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;week&quot;</span>, </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;rank&quot;</span>,</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_drop_na =</span> <span class="cn">TRUE</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span>  </span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> <span class="fu">parse_number</span>(week)</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>billboard_longer</span></code></pre></div>
<pre><code>## # A tibble: 5,307 × 5
##    artist  track                   date.entered  week  rank
##    &lt;chr&gt;   &lt;chr&gt;                   &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26       1    87
##  2 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26       2    82
##  3 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26       3    72
##  4 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26       4    77
##  5 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26       5    87
##  6 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26       6    94
##  7 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26       7    99
##  8 2Ge+her The Hardest Part Of ... 2000-09-02       1    91
##  9 2Ge+her The Hardest Part Of ... 2000-09-02       2    87
## 10 2Ge+her The Hardest Part Of ... 2000-09-02       3    92
## # ℹ 5,297 more rows</code></pre>
<p>Jetzt, da wir alle Wochennummern in einer Variablen und alle
Rangwerte in einer anderen Variablen haben, sind wir in einer guten
Position, um zu visualisieren, wie sich die Song-Ränge im Laufe der Zeit
ändern. Der Code wird unten angezeigt und das Ergebnis ist in der
Abbildung zu sehen. Wir können sehen, dass nur sehr wenige Songs mehr
als 20 Wochen lang in den Top 100 bleiben.</p>
<div class="sourceCode" id="cb114"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>billboard_longer <span class="sc">%&gt;%</span>  </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> rank, <span class="at">group =</span> track)) <span class="sc">+</span> </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
</div>
<div id="wie-funktioniert-das-pivoting" class="section level3">
<h3>Wie funktioniert das Pivoting?</h3>
<p>Jetzt, da du gesehen hast, wie wir das Pivoting verwenden können, um
unsere Daten umzuformen, nehmen wir uns etwas Zeit, um ein intuitives
Verständnis dafür zu entwickeln, was das Pivoting mit den Daten macht.
Beginnen wir mit einem sehr einfachen Datensatz, um zu sehen, was
passiert. Angenommen, wir haben drei Patienten mit den ids A, B und C
und wir nehmen zwei Blutdruckmessungen bei jedem Patienten vor. Wir
werden die Daten mit tribble() erstellen, einer praktischen Funktion zum
manuellen Erstellen kleiner Tibbles:</p>
<div class="sourceCode" id="cb115"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id,  <span class="sc">~</span>bp1, <span class="sc">~</span>bp2,</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;A&quot;</span>,  <span class="dv">100</span>,  <span class="dv">120</span>,</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;B&quot;</span>,  <span class="dv">140</span>,  <span class="dv">115</span>,</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;C&quot;</span>,  <span class="dv">120</span>,  <span class="dv">125</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Wir möchten, dass unser neuer Datensatz drei Variablen enthält: id
(existiert bereits), measurement (die Spaltennamen) und value (die
Zellenwerte). Um dies zu erreichen, müssen wir df länger drehen
(pivotieren):</p>
<div class="sourceCode" id="cb116"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span>  </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> bp1<span class="sc">:</span>bp2,</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;measurement&quot;</span>,</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   id    measurement value
##   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;
## 1 A     bp1           100
## 2 A     bp2           120
## 3 B     bp1           140
## 4 B     bp2           115
## 5 C     bp1           120
## 6 C     bp2           125</code></pre>
<p>Wie funktioniert das Umgestalten? Es ist einfacher zu verstehen, wenn
wir es spaltenweise betrachten. Wie in der Abbildung dargestellt, müssen
die Werte in der Spalte, die bereits eine Variable im ursprünglichen
Datensatz war (<code>id</code>), für jede umgeformte Spalte wiederholt
werden.</p>
<div class="figure">
<img src="images/r4ds/variables.png" alt="" />
<p class="caption">Grafik aus R for Data Science (2e):
r4ds.hadley.nz</p>
</div>
<p>Die Spaltennamen werden zu Werten in einer neuen Variable, deren Name
durch <code>names_to</code> definiert wird, wie unten gezeigt. Sie
müssen für jede Zeile im ursprünglichen Datensatz einmal wiederholt
werden.</p>
<div class="figure">
<img src="images/r4ds/column-names.png" alt="" />
<p class="caption">Grafik aus R for Data Science (2e):
r4ds.hadley.nz</p>
</div>
<p>Die Zellenwerte werden ebenfalls zu Werten in einer neuen Variable,
deren Name durch values_to definiert wird. Sie werden Zeile für Zeile
aufgedröselt. Der Prozess ist hier veranschaulicht:</p>
<div class="figure">
<img src="images/r4ds/cell-values.png" alt="" />
<p class="caption">Grafik aus R for Data Science (2e):
r4ds.hadley.nz</p>
</div>
</div>
<div id="viele-variablen-im-spaltennamen" class="section level3">
<h3>Viele Variablen im Spaltennamen</h3>
<p>Eine anspruchsvollere Situation tritt auf, wenn mehrere Informationen
in den Spaltennamen zusammengefasst sind und du diese in separaten neuen
Variablen speichern möchtest. Nehmen wir zum Beispiel den Datensatz
<code>who2</code>, der die Grundlage für <code>table1</code> und
ähnliche Tabellen bildet, die du oben gesehen hast:</p>
<div class="sourceCode" id="cb118"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>who2</span></code></pre></div>
<pre><code>## # A tibble: 7,240 × 58
##    country      year sp_m_014 sp_m_1524 sp_m_2534 sp_m_3544 sp_m_4554 sp_m_5564 sp_m_65 sp_f_014 sp_f_1524 sp_f_2534 sp_f_3544 sp_f_4554 sp_f_5564 sp_f_65
##    &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghanistan  1980       NA        NA        NA        NA        NA        NA      NA       NA        NA        NA        NA        NA        NA      NA
##  2 Afghanistan  1981       NA        NA        NA        NA        NA        NA      NA       NA        NA        NA        NA        NA        NA      NA
##  3 Afghanistan  1982       NA        NA        NA        NA        NA        NA      NA       NA        NA        NA        NA        NA        NA      NA
##  4 Afghanistan  1983       NA        NA        NA        NA        NA        NA      NA       NA        NA        NA        NA        NA        NA      NA
##  5 Afghanistan  1984       NA        NA        NA        NA        NA        NA      NA       NA        NA        NA        NA        NA        NA      NA
##  6 Afghanistan  1985       NA        NA        NA        NA        NA        NA      NA       NA        NA        NA        NA        NA        NA      NA
##  7 Afghanistan  1986       NA        NA        NA        NA        NA        NA      NA       NA        NA        NA        NA        NA        NA      NA
##  8 Afghanistan  1987       NA        NA        NA        NA        NA        NA      NA       NA        NA        NA        NA        NA        NA      NA
##  9 Afghanistan  1988       NA        NA        NA        NA        NA        NA      NA       NA        NA        NA        NA        NA        NA      NA
## 10 Afghanistan  1989       NA        NA        NA        NA        NA        NA      NA       NA        NA        NA        NA        NA        NA      NA
## # ℹ 7,230 more rows
## # ℹ 42 more variables: sn_m_014 &lt;dbl&gt;, sn_m_1524 &lt;dbl&gt;, sn_m_2534 &lt;dbl&gt;, sn_m_3544 &lt;dbl&gt;, sn_m_4554 &lt;dbl&gt;, sn_m_5564 &lt;dbl&gt;, sn_m_65 &lt;dbl&gt;,
## #   sn_f_014 &lt;dbl&gt;, sn_f_1524 &lt;dbl&gt;, sn_f_2534 &lt;dbl&gt;, sn_f_3544 &lt;dbl&gt;, sn_f_4554 &lt;dbl&gt;, sn_f_5564 &lt;dbl&gt;, sn_f_65 &lt;dbl&gt;, ep_m_014 &lt;dbl&gt;, ep_m_1524 &lt;dbl&gt;,
## #   ep_m_2534 &lt;dbl&gt;, ep_m_3544 &lt;dbl&gt;, ep_m_4554 &lt;dbl&gt;, ep_m_5564 &lt;dbl&gt;, ep_m_65 &lt;dbl&gt;, ep_f_014 &lt;dbl&gt;, ep_f_1524 &lt;dbl&gt;, ep_f_2534 &lt;dbl&gt;, ep_f_3544 &lt;dbl&gt;,
## #   ep_f_4554 &lt;dbl&gt;, ep_f_5564 &lt;dbl&gt;, ep_f_65 &lt;dbl&gt;, rel_m_014 &lt;dbl&gt;, rel_m_1524 &lt;dbl&gt;, rel_m_2534 &lt;dbl&gt;, rel_m_3544 &lt;dbl&gt;, rel_m_4554 &lt;dbl&gt;,
## #   rel_m_5564 &lt;dbl&gt;, rel_m_65 &lt;dbl&gt;, rel_f_014 &lt;dbl&gt;, rel_f_1524 &lt;dbl&gt;, rel_f_2534 &lt;dbl&gt;, rel_f_3544 &lt;dbl&gt;, rel_f_4554 &lt;dbl&gt;, rel_f_5564 &lt;dbl&gt;,
## #   rel_f_65 &lt;dbl&gt;</code></pre>
<p>Dieser Datensatz, der von der Weltgesundheitsorganisation (WHO)
gesammelt wurde, enthält Informationen über Tuberkulose-Diagnosen. Es
gibt zwei Spalten, die bereits Variablen sind und leicht interpretiert
werden können: <code>country</code> und <code>year</code>. Darauf folgen
56 Spalten wie <code>sp_m_014</code>, <code>ep_m_4554</code> und
<code>rel_m_3544</code>. Wenn du diese Spalten lange genug betrachtest,
wirst du ein Muster erkennen. Jeder Spaltenname besteht aus drei Teilen,
die durch <code>_</code> getrennt sind. Der erste Teil,
<code>sp</code>/<code>rel</code>/<code>ep</code>, beschreibt die
Methode, die für die Diagnose verwendet wurde. Der zweite Teil,
<code>m</code>/<code>f</code>, steht für das Geschlecht (kodiert als
binäre Variable in diesem Datensatz), und der dritte Teil,
<code>014</code>/<code>1524</code>/<code>2534</code>/<code>3544</code>/<code>4554</code>/<code>5564</code>/<code>65</code>,
steht für die Altersgruppe (<code>014</code> repräsentiert zum Beispiel
die Altersgruppe 0-14).</p>
<p>In diesem Fall haben wir sechs Informationen im Datensatz
<code>who2</code> erfasst: das Land und das Jahr (bereits vorhandene
Spalten), die Diagnosemethode, die Geschlechtskategorie und die
Altersgruppenkategorie (enthalten in den anderen Spaltennamen) sowie die
Anzahl der Patienten in dieser Kategorie (Zellenwerte). Um diese sechs
Informationen in sechs separaten Spalten zu organisieren, verwenden wir
<code>pivot_longer()</code> mit einem Vektor von Spaltennamen für
<code>names_to</code> und Anweisungen zum Aufteilen der ursprünglichen
Variablennamen in Teile für <code>names_sep</code>, sowie einem
Spaltennamen für <code>values_to</code>:</p>
<div class="sourceCode" id="cb120"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>who2 <span class="sc">%&gt;%</span>  </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">!</span>(country<span class="sc">:</span>year),</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;diagnosis&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;age&quot;</span>), </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;count&quot;</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 405,440 × 6
##    country      year diagnosis gender age   count
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
##  1 Afghanistan  1980 sp        m      014      NA
##  2 Afghanistan  1980 sp        m      1524     NA
##  3 Afghanistan  1980 sp        m      2534     NA
##  4 Afghanistan  1980 sp        m      3544     NA
##  5 Afghanistan  1980 sp        m      4554     NA
##  6 Afghanistan  1980 sp        m      5564     NA
##  7 Afghanistan  1980 sp        m      65       NA
##  8 Afghanistan  1980 sp        f      014      NA
##  9 Afghanistan  1980 sp        f      1524     NA
## 10 Afghanistan  1980 sp        f      2534     NA
## # ℹ 405,430 more rows</code></pre>
<p>Eine Alternative zu <code>names_sep</code> ist
<code>names_pattern</code>, das du verwenden kannst, um Variablen aus
komplexeren Namensszenarien zu extrahieren, sobald du dich mit RegExps
vertraut gemacht hast.</p>
<p>Konzeptuell handelt es sich nur um eine geringfügige Abweichung von
dem einfacheren Fall, den du bereits gesehen hast. Die Abbidlung zeigt
die grundlegende Idee: Anstatt dass die Spaltennamen in eine einzige
Spalte umgeformt werden, werden sie in mehrere Spalten umgeformt. Du
kannst dir vorstellen, dass dies in zwei Schritten geschieht (erst
Umformung und dann Aufteilung), aber unter der Haube geschieht dies in
einem einzigen Schritt, weil es schneller ist.</p>
<div class="figure">
<img src="images/r4ds/multiple-names.png" alt="" />
<p class="caption">Grafik aus R for Data Science (2e):
r4ds.hadley.nz</p>
</div>
</div>
<div id="daten-und-variablennamen-in-den-spaltenüberschriften"
class="section level3">
<h3>Daten und Variablennamen in den Spaltenüberschriften</h3>
<p>Der nächste Schritt in der Komplexität besteht darin, dass die
Spaltennamen eine Mischung aus Variablenwerten und Variablennamen
enthalten. Nehmen wir zum Beispiel den Datensatz
<code>household</code>:</p>
<div class="sourceCode" id="cb122"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>household</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   family dob_child1 dob_child2 name_child1 name_child2
##    &lt;int&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;       &lt;chr&gt;      
## 1      1 1998-11-26 2000-01-29 Susan       Jose       
## 2      2 1996-06-22 NA         Mark        &lt;NA&gt;       
## 3      3 2002-07-11 2004-04-05 Sam         Seth       
## 4      4 2004-10-10 2009-08-27 Craig       Khai       
## 5      5 2000-12-05 2005-02-28 Parker      Gracie</code></pre>
<p>Dieser Datensatz enthält Daten zu fünf Familien mit den Namen und
Geburtsdaten von bis zu zwei Kindern. Die neue Herausforderung bei
diesem Datensatz besteht darin, dass die Spaltennamen die Namen von zwei
Variablen (<code>dob</code>, <code>name</code>) und die Werte einer
anderen Variablen (<code>child</code>, mit den Werten 1 oder 2)
enthalten. Um dieses Problem zu lösen, müssen wir erneut einen Vektor an
<code>names_to</code> übergeben, verwenden jedoch dieses Mal das
spezielle <code>".value"</code>-Sentinel. Dies ist nicht der Name einer
Variablen, sondern ein eindeutiger Wert, der <code>pivot_longer()</code>
mitteilt, etwas anderes zu tun. Dies überschreibt das übliche Argument
<code>values_to</code>, um den ersten Bestandteil des umgeformten
Spaltennamens als Variablennamen in der Ausgabe zu verwenden.</p>
<div class="sourceCode" id="cb124"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>household <span class="sc">%&gt;%</span>  </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">!</span>family, </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;child&quot;</span>), </span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>, </span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_drop_na =</span> <span class="cn">TRUE</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 9 × 4
##   family child  dob        name  
##    &lt;int&gt; &lt;chr&gt;  &lt;date&gt;     &lt;chr&gt; 
## 1      1 child1 1998-11-26 Susan 
## 2      1 child2 2000-01-29 Jose  
## 3      2 child1 1996-06-22 Mark  
## 4      3 child1 2002-07-11 Sam   
## 5      3 child2 2004-04-05 Seth  
## 6      4 child1 2004-10-10 Craig 
## 7      4 child2 2009-08-27 Khai  
## 8      5 child1 2000-12-05 Parker
## 9      5 child2 2005-02-28 Gracie</code></pre>
<p>Wir verwenden erneut <code>values_drop_na = TRUE</code>, da die
Struktur der Eingabe die Erzeugung von expliziten fehlenden Variablen
erzwingt (z. B. für Familien mit nur einem Kind).</p>
<p>Vielleicht kann ein weiteres Beispiel die Funktionsweise
verdeutlichen. Nehmen wir einen einfachen Datensatz:</p>
<div class="sourceCode" id="cb126"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>a3 <span class="ot">&lt;-</span> <span class="fu">head</span>(anscombe,<span class="dv">3</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>a3</span></code></pre></div>
<pre><code>##   x1 x2 x3 x4   y1   y2    y3   y4
## 1 10 10 10  8 8.04 9.14  7.46 6.58
## 2  8  8  8  8 6.95 8.14  6.77 5.76
## 3 13 13 13  8 7.58 8.74 12.74 7.71</code></pre>
<p>Dies ist ein breites Format, das wir in ein langes Format umwandeln
wollen. Mit der normalen Funktion pivot_longer() erhalten wir folgendes
Ergebnis:</p>
<div class="sourceCode" id="cb128"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>a3 <span class="sc">%&gt;%</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">everything</span>(),</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;charpart&quot;</span>, <span class="st">&quot;numpart&quot;</span>),</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">&quot;(.)(.)&quot;</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 24 × 3
##    charpart numpart value
##    &lt;chr&gt;    &lt;chr&gt;   &lt;dbl&gt;
##  1 x        1       10   
##  2 x        2       10   
##  3 x        3       10   
##  4 x        4        8   
##  5 y        1        8.04
##  6 y        2        9.14
##  7 y        3        7.46
##  8 y        4        6.58
##  9 x        1        8   
## 10 x        2        8   
## # ℹ 14 more rows</code></pre>
<p>Dies ist ein langes Format. Wenn wir annehmen, dass x1 und y1 oder x2
und y2 oder … zur selben Beobachtung gehören, dann müssen wir eine
andere Ausgabe erzeugen. Sie sollte so aussehen, dass wir
<code>numpart</code>, <code>x</code> und <code>y</code> als Spaltennamen
haben. <code>x</code> und <code>y</code> sind dann die Werte, während
<code>numpart</code> die eindeutige Beobachtung angibt. Sieh dir die
Originaltabelle an und überlege, was theoretisch zu tun wäre. Alle Werte
einer Spalte, die mit <code>x</code> beginnen, müssen in die neue Spalte
<code>x</code> geschrieben werden. Alle Spalten, die mit <code>y</code>
beginnen, müssen in y geschrieben werden. Als zusätzliche Information
benötigen wir die Endung des ursprünglichen Spaltennamens als neue
Spalte <code>numpart</code>. Diesen Anwendungsfall können wir mit
<code>.value</code> realisieren. “.value” bedeutet, dass die
entsprechende Komponente des Spaltennamens (hier <code>x</code> oder
<code>y</code>) den Namen der Ausgabespalte definiert. Diese neuen
Spalten <code>x</code> und <code>y</code> enthalten die Werte der
ursprünglichen Zellen, wobei values_to ignoriert wird.</p>
<div class="sourceCode" id="cb130"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>a3 <span class="sc">%&gt;%</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">everything</span>(),</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;numpart&quot;</span>),</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">&quot;(.)(.)&quot;</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##    numpart     x     y
##    &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1 1          10  8.04
##  2 2          10  9.14
##  3 3          10  7.46
##  4 4           8  6.58
##  5 1           8  6.95
##  6 2           8  8.14
##  7 3           8  6.77
##  8 4           8  5.76
##  9 1          13  7.58
## 10 2          13  8.74
## 11 3          13 12.7 
## 12 4           8  7.71</code></pre>
<p>Die Abbildungveranschaulicht die grundlegende Idee anhand eines
weiteren einfachen Beispiels. Wenn du <code>".value"</code> in
<code>names_to</code> verwendest, tragen die Spaltennamen in der Eingabe
sowohl zu den Werten als auch zu den Variablennamen in der Ausgabe
bei.</p>
<div class="figure">
<img src="images/r4ds/names-and-values.png" alt="" />
<p class="caption">Grafik aus R for Data Science (2e):
r4ds.hadley.nz</p>
</div>
</div>
</div>
<div id="verbreitern-der-daten" class="section level2">
<h2>Verbreitern der Daten</h2>
<p>Bisher haben wir <code>pivot_longer()</code> verwendet, um die häufig
auftretende Problematik zu lösen, bei der Werte in den Spaltennamen
landen. Als Nächstes wenden wir uns <code>pivot_wider()</code> zu, das
Datensätze <strong>breiter</strong> macht, indem es Spalten erhöht und
Zeilen reduziert, und uns hilft, wenn eine Beobachtung auf mehrere
Zeilen verteilt ist. Dies scheint seltener vorzukommen, aber es taucht
häufig bei der Verarbeitung von Regierungsdaten auf.</p>
<p>Wir beginnen mit dem Datensatz <code>cms_patient_experience</code>,
einem Datensatz der Centers for Medicare and Medicaid Services, der
Daten zu den Erfahrungen von Patienten sammelt:</p>
<div class="sourceCode" id="cb132"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>cms_patient_experience</span></code></pre></div>
<pre><code>## # A tibble: 500 × 5
##    org_pac_id org_nm                               measure_cd   measure_title                                                          prf_rate
##    &lt;chr&gt;      &lt;chr&gt;                                &lt;chr&gt;        &lt;chr&gt;                                                                     &lt;dbl&gt;
##  1 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_1  CAHPS for MIPS SSM: Getting Timely Care, Appointments, and Information       63
##  2 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_2  CAHPS for MIPS SSM: How Well Providers Communicate                           87
##  3 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_3  CAHPS for MIPS SSM: Patient&#39;s Rating of Provider                             86
##  4 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_5  CAHPS for MIPS SSM: Health Promotion and Education                           57
##  5 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_8  CAHPS for MIPS SSM: Courteous and Helpful Office Staff                       85
##  6 0446157747 USC CARE MEDICAL GROUP INC           CAHPS_GRP_12 CAHPS for MIPS SSM: Stewardship of Patient Resources                         24
##  7 0446162697 ASSOCIATION OF UNIVERSITY PHYSICIANS CAHPS_GRP_1  CAHPS for MIPS SSM: Getting Timely Care, Appointments, and Information       59
##  8 0446162697 ASSOCIATION OF UNIVERSITY PHYSICIANS CAHPS_GRP_2  CAHPS for MIPS SSM: How Well Providers Communicate                           85
##  9 0446162697 ASSOCIATION OF UNIVERSITY PHYSICIANS CAHPS_GRP_3  CAHPS for MIPS SSM: Patient&#39;s Rating of Provider                             83
## 10 0446162697 ASSOCIATION OF UNIVERSITY PHYSICIANS CAHPS_GRP_5  CAHPS for MIPS SSM: Health Promotion and Education                           63
## # ℹ 490 more rows</code></pre>
<p>Die Kerngröße, die untersucht wird, ist eine Organisation, aber jede
Organisation ist auf sechs Zeilen verteilt, wobei jede Zeile eine
Messung in der untersuchten Organisation darstellt. Wir können den
vollständigen Satz von Werten für <code>measure_cd</code> und
<code>measure_title</code> mit <code>distinct()</code> anzeigen:</p>
<div class="sourceCode" id="cb134"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>cms_patient_experience <span class="sc">%&gt;%</span>  </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(measure_cd, measure_title)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   measure_cd   measure_title                                                         
##   &lt;chr&gt;        &lt;chr&gt;                                                                 
## 1 CAHPS_GRP_1  CAHPS for MIPS SSM: Getting Timely Care, Appointments, and Information
## 2 CAHPS_GRP_2  CAHPS for MIPS SSM: How Well Providers Communicate                    
## 3 CAHPS_GRP_3  CAHPS for MIPS SSM: Patient&#39;s Rating of Provider                      
## 4 CAHPS_GRP_5  CAHPS for MIPS SSM: Health Promotion and Education                    
## 5 CAHPS_GRP_8  CAHPS for MIPS SSM: Courteous and Helpful Office Staff                
## 6 CAHPS_GRP_12 CAHPS for MIPS SSM: Stewardship of Patient Resources</code></pre>
<p>Keine dieser Spalten eignet sich besonders gut als Variablennamen:
<code>measure_cd</code> gibt keinen Hinweis auf die Bedeutung der
Variablen, und <code>measure_title</code> ist ein langer Satz mit
Leerzeichen. Vorerst verwenden wir <code>measure_cd</code> als Quelle
für unsere neuen Spaltennamen, aber in einer echten Analyse möchtest du
vielleicht eigene Variablennamen erstellen, die sowohl kurz als auch
aussagekräftig sind.</p>
<p><code>pivot_wider()</code> hat die entgegengesetzte Schnittstelle zu
<code>pivot_longer()</code>: Anstatt neue Spaltennamen auszuwählen,
müssen wir die vorhandenen Spalten angeben, die die Werte definieren
(<code>values_from</code>) und den Spaltennamen
(<code>names_from</code>):</p>
<div class="sourceCode" id="cb136"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>cms_patient_experience <span class="sc">%&gt;%</span>  </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measure_cd,</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> prf_rate</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 500 × 9
##    org_pac_id org_nm                               measure_title                  CAHPS_GRP_1 CAHPS_GRP_2 CAHPS_GRP_3 CAHPS_GRP_5 CAHPS_GRP_8 CAHPS_GRP_12
##    &lt;chr&gt;      &lt;chr&gt;                                &lt;chr&gt;                                &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1 0446157747 USC CARE MEDICAL GROUP INC           CAHPS for MIPS SSM: Getting T…          63          NA          NA          NA          NA           NA
##  2 0446157747 USC CARE MEDICAL GROUP INC           CAHPS for MIPS SSM: How Well …          NA          87          NA          NA          NA           NA
##  3 0446157747 USC CARE MEDICAL GROUP INC           CAHPS for MIPS SSM: Patient&#39;s…          NA          NA          86          NA          NA           NA
##  4 0446157747 USC CARE MEDICAL GROUP INC           CAHPS for MIPS SSM: Health Pr…          NA          NA          NA          57          NA           NA
##  5 0446157747 USC CARE MEDICAL GROUP INC           CAHPS for MIPS SSM: Courteous…          NA          NA          NA          NA          85           NA
##  6 0446157747 USC CARE MEDICAL GROUP INC           CAHPS for MIPS SSM: Stewardsh…          NA          NA          NA          NA          NA           24
##  7 0446162697 ASSOCIATION OF UNIVERSITY PHYSICIANS CAHPS for MIPS SSM: Getting T…          59          NA          NA          NA          NA           NA
##  8 0446162697 ASSOCIATION OF UNIVERSITY PHYSICIANS CAHPS for MIPS SSM: How Well …          NA          85          NA          NA          NA           NA
##  9 0446162697 ASSOCIATION OF UNIVERSITY PHYSICIANS CAHPS for MIPS SSM: Patient&#39;s…          NA          NA          83          NA          NA           NA
## 10 0446162697 ASSOCIATION OF UNIVERSITY PHYSICIANS CAHPS for MIPS SSM: Health Pr…          NA          NA          NA          63          NA           NA
## # ℹ 490 more rows</code></pre>
<p>Die Ausgabe sieht noch nicht ganz richtig aus; es scheint immer noch
mehrere Zeilen für jede Organisation zu geben. Das liegt daran, dass wir
<code>pivot_wider()</code> auch mitteilen müssen, welche Spalte oder
Spalten Werte enthalten, die jede Zeile eindeutig identifizieren; in
diesem Fall sind das die Variablen, die mit <code>"org"</code>
beginnen:</p>
<div class="sourceCode" id="cb138"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>cms_patient_experience <span class="sc">%&gt;%</span>  </span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;org&quot;</span>),</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measure_cd,</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> prf_rate</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 95 × 8
##    org_pac_id org_nm                                     CAHPS_GRP_1 CAHPS_GRP_2 CAHPS_GRP_3 CAHPS_GRP_5 CAHPS_GRP_8 CAHPS_GRP_12
##    &lt;chr&gt;      &lt;chr&gt;                                            &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1 0446157747 USC CARE MEDICAL GROUP INC                          63          87          86          57          85           24
##  2 0446162697 ASSOCIATION OF UNIVERSITY PHYSICIANS                59          85          83          63          88           22
##  3 0547164295 BEAVER MEDICAL GROUP PC                             49          NA          75          44          73           12
##  4 0749333730 CAPE PHYSICIANS ASSOCIATES PA                       67          84          85          65          82           24
##  5 0840104360 ALLIANCE PHYSICIANS INC                             66          87          87          64          87           28
##  6 0840109864 REX HOSPITAL INC                                    73          87          84          67          91           30
##  7 0840513552 SCL HEALTH MEDICAL GROUP DENVER LLC                 58          83          76          58          78           26
##  8 0941545784 GRITMAN MEDICAL CENTER INC                          46          86          81          54          NA           25
##  9 1052612785 COMMUNITY MEDICAL GROUP LLC                         65          84          80          58          87           29
## 10 1254237779 OUR LADY OF LOURDES MEMORIAL HOSPITAL, INC          61          NA          NA          65          NA           17
## # ℹ 85 more rows</code></pre>
<p>Damit erhalten wir die gewünschte Ausgabe.</p>
<div id="wie-funktioniert-pivot_wider" class="section level3">
<h3>Wie funktioniert <code>pivot_wider()</code>?</h3>
<p>Um zu verstehen, wie <code>pivot_wider()</code> funktioniert,
beginnen wir erneut mit einem sehr einfachen Datensatz. Dieses Mal haben
wir zwei Patienten mit den IDs A und B sowie drei Blutdruckmessungen für
Patient A und zwei für Patient B:</p>
<div class="sourceCode" id="cb140"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id, <span class="sc">~</span>measurement, <span class="sc">~</span>value,</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A&quot;</span>,        <span class="st">&quot;bp1&quot;</span>,    <span class="dv">100</span>,</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;B&quot;</span>,        <span class="st">&quot;bp1&quot;</span>,    <span class="dv">140</span>,</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;B&quot;</span>,        <span class="st">&quot;bp2&quot;</span>,    <span class="dv">115</span>, </span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A&quot;</span>,        <span class="st">&quot;bp2&quot;</span>,    <span class="dv">120</span>,</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A&quot;</span>,        <span class="st">&quot;bp3&quot;</span>,    <span class="dv">105</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Wir nehmen die Werte aus der Spalte <code>value</code> und die Namen
aus der Spalte <code>measurement</code>:</p>
<div class="sourceCode" id="cb141"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span>  </span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measurement,</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   id      bp1   bp2   bp3
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A       100   120   105
## 2 B       140   115    NA</code></pre>
<p>Um den Prozess zu beginnen, muss <code>pivot_wider()</code> zuerst
herausfinden, was in den Zeilen und Spalten stehen wird. Die neuen
Spaltennamen sind die eindeutigen Werte von
<code>measurement</code>.</p>
<div class="sourceCode" id="cb143"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span>  </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(measurement) <span class="sc">%&gt;%</span>  </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span></code></pre></div>
<pre><code>## [1] &quot;bp1&quot; &quot;bp2&quot; &quot;bp3&quot;</code></pre>
<p>Standardmäßig werden die Zeilen im Ausgabedatensatz durch alle
Variablen bestimmt, die nicht in die neuen Spalten- oder Wertekategorien
übernommen werden. Diese werden <code>id_cols</code> genannt. In diesem
Fall gibt es nur eine Spalte, aber allgemein können es beliebig viele
sein.</p>
<div class="sourceCode" id="cb145"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span>  </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>measurement, <span class="sc">-</span>value) <span class="sc">%&gt;%</span>  </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 × 1
##   id   
##   &lt;chr&gt;
## 1 A    
## 2 B</code></pre>
<p><code>pivot_wider()</code> kombiniert dann diese Ergebnisse, um einen
leeren Datensatz zu generieren:</p>
<div class="sourceCode" id="cb147"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span>  </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>measurement, <span class="sc">-</span>value) <span class="sc">%&gt;%</span>  </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="cn">NA</span>, <span class="at">y =</span> <span class="cn">NA</span>, <span class="at">z =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   id    x     y     z    
##   &lt;chr&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;
## 1 A     NA    NA    NA   
## 2 B     NA    NA    NA</code></pre>
<p>Anschließend werden alle fehlenden Werte mit den Daten aus dem
Eingabedatensatz aufgefüllt. In diesem Fall gibt es keine dritte
Blutdruckmessung für Patient B, daher bleibt diese Zelle leer.</p>
<p>Du fragst dich vielleicht auch, was passiert, wenn es mehrere Zeilen
im Eingabedatensatz gibt, die einer Zelle im Ausgabedatensatz
entsprechen. Das folgende Beispiel hat zwei Zeilen, die der
<code>id</code> “A” und der <code>measurement</code> “bp1”
entsprechen:</p>
<div class="sourceCode" id="cb149"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id, <span class="sc">~</span>measurement, <span class="sc">~</span>value,</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A&quot;</span>,        <span class="st">&quot;bp1&quot;</span>,    <span class="dv">100</span>,</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A&quot;</span>,        <span class="st">&quot;bp1&quot;</span>,    <span class="dv">102</span>,</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A&quot;</span>,        <span class="st">&quot;bp2&quot;</span>,    <span class="dv">120</span>,</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;B&quot;</span>,        <span class="st">&quot;bp1&quot;</span>,    <span class="dv">140</span>, </span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;B&quot;</span>,        <span class="st">&quot;bp2&quot;</span>,    <span class="dv">115</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Wenn wir versuchen, dies zu verarbeiten, erhalten wir eine Ausgabe,
die Listenspalten enthält:</p>
<div class="sourceCode" id="cb150"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measurement,</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: Values from `value` are not uniquely identified; output will contain list-cols.
## • Use `values_fn = list` to suppress this warning.
## • Use `values_fn = {summary_fun}` to summarise duplicates.
## • Use the following dplyr code to identify duplicates.
##   {data} %&gt;%
##   dplyr::group_by(id, measurement) %&gt;%
##   dplyr::summarise(n = dplyr::n(), .groups = &quot;drop&quot;) %&gt;%
##   dplyr::filter(n &gt; 1L)</code></pre>
<pre><code>## # A tibble: 2 × 3
##   id    bp1       bp2      
##   &lt;chr&gt; &lt;list&gt;    &lt;list&gt;   
## 1 A     &lt;dbl [2]&gt; &lt;dbl [1]&gt;
## 2 B     &lt;dbl [1]&gt; &lt;dbl [1]&gt;</code></pre>
<p>Da du noch nicht weißt, wie du mit solchen Daten</p>
<p>arbeiten kannst, solltest du dem Hinweis in der Warnung folgen, um
herauszufinden, wo das Problem liegt:</p>
<div class="sourceCode" id="cb153"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span>  </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id, measurement) <span class="sc">%&gt;%</span>  </span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   id    measurement     n
##   &lt;chr&gt; &lt;chr&gt;       &lt;int&gt;
## 1 A     bp1             2</code></pre>
<p>Dann liegt es an dir, herauszufinden, was mit deinen Daten
schiefgegangen ist, und entweder den zugrunde liegenden Fehler zu
beheben oder deine Gruppierungs- und Zusammenfassungsfähigkeiten zu
nutzen, um sicherzustellen, dass jede Kombination von Zeilen- und
Spaltenwerten nur eine einzelne Zeile hat.</p>
</div>
</div>
<div id="zusammenfassung" class="section level2">
<h2>Zusammenfassung</h2>
<p>In diesem Kapitel hast du etwas über übersichtliche Daten gelernt:
Daten, bei denen Variablen in Spalten und Beobachtungen in Zeilen
angeordnet sind. Übersichtliche Daten erleichtern die Arbeit mit dem
Tidyverse, da es sich um eine konsistente Struktur handelt, die von den
meisten Funktionen verstanden wird. Die Hauptherausforderung besteht
darin, die Daten von ihrer ursprünglichen Struktur in ein
übersichtliches Format zu transformieren. Zu diesem Zweck hast du
gelernt, wie man <code>pivot_longer()</code> und
<code>pivot_wider()</code> verwendet, um viele unübersichtliche
Datensätze aufzubereiten. Die hier vorgestellten Beispiele sind eine
Auswahl aus der Vignette “pivot” des Pakets “tidyr”. Wenn du auf ein
Problem stößt, das in diesem Kapitel nicht behandelt wird, ist diese
Vignette ein guter nächster Anlaufpunkt.</p>
<p>Eine weitere Herausforderung besteht darin, dass es für einen
gegebenen Datensatz unmöglich sein kann, die längere oder breitere
Version als die “übersichtliche” zu kennzeichnen. Dies ist teilweise
eine Reflexion unserer Definition von übersichtlichen Daten, bei der wir
gesagt haben, dass übersichtliche Daten eine Variable in jeder Spalte
haben, aber wir haben tatsächlich nicht definiert, was eine Variable ist
(und es ist überraschend schwierig, dies zu tun). Es ist völlig in
Ordnung, pragmatisch zu sein und zu sagen, dass eine Variable das ist,
was deine Analyse am einfachsten macht. Wenn du also Schwierigkeiten
hast, eine Berechnung durchzuführen, solltest du in Betracht ziehen, die
Organisation deiner Daten zu ändern. Hab keine Angst, sie zu entfalten,
zu transformieren und bei Bedarf erneut zu ordnen!</p>
<p>Wenn dir dieses Kapitel gefallen hat und du mehr über die zugrunde
liegende Theorie erfahren möchtest, kannst du weitere Informationen zur
Geschichte und den theoretischen Grundlagen in dem <a
href="https://www.jstatsoft.org/article/view/v059i10">Tidy
Data</a>-Artikel nachlesen, der in der Zeitschrift Journal of
Statistical Software veröffentlicht wurde.</p>
<p>Jetzt, da du eine beträchtliche Menge an R-Code schreibst, ist es an
der Zeit, mehr über die Organisation deines Codes in Dateien und
Verzeichnissen zu lernen. Im nächsten Kapitel wirst du alles über die
Vorteile von Skripten und Projekten erfahren und einige der vielen Tools
kennenlernen, die sie bieten, um dir das Leben zu erleichtern.</p>
</div>
<div id="übung-4" class="section level2">
<h2>Übung 4</h2>
<ol style="list-style-type: decimal">
<li><p>Verwandle breite Daten in lange Daten: Angenommen, du hast einen
Datensatz mit den Spalten “Land”, “Januar”, “Februar” und “März”, wobei
jede Spalte die Anzahl der Besucher in diesem Monat darstellt. Verwende
<code>pivot_longer()</code>, um die Daten in ein Format umzuwandeln, in
dem jeder Monat in einer separaten Zeile steht.</p>
<div class="sourceCode" id="cb155"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>daten <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Land, <span class="sc">~</span>Januar, <span class="sc">~</span>Februar, <span class="sc">~</span>März,</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Deutschland&quot;</span>, <span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">90</span>,</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;USA&quot;</span>, <span class="dv">150</span>, <span class="dv">180</span>, <span class="dv">200</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div></li>
<li><p>Aggregiere mehrere Spalten zu einer einzigen Spalte: Angenommen,
du hast einen Datensatz mit den Spalten “ID”, “Kategorie_A”,
“Kategorie_B” und “Kategorie_C”, wobei jede Kategorie den Wert für eine
bestimmte ID darstellt. Verwende <code>pivot_longer()</code>, um die
Kategorien in einer einzigen Spalte namens “Kategorie”
zusammenzufassen.</p>
<div class="sourceCode" id="cb156"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>daten <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>ID, <span class="sc">~</span>Kategorie_A, <span class="sc">~</span>Kategorie_B, <span class="sc">~</span>Kategorie_C,</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&quot;A1&quot;</span>, <span class="st">&quot;B1&quot;</span>, <span class="st">&quot;C1&quot;</span>,</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;A2&quot;</span>, <span class="st">&quot;B2&quot;</span>, <span class="st">&quot;C2&quot;</span>,</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="st">&quot;A3&quot;</span>, <span class="st">&quot;B3&quot;</span>, <span class="st">&quot;C3&quot;</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div></li>
<li><p>Arbeite mit Spaltennamen als Werten: Angenommen, du hast einen
Datensatz mit den Spalten “Produkt_A”, “Produkt_B” und “Produkt_C”,
wobei jede Spalte den Verkaufspreis für das entsprechende Produkt
darstellt. Verwende <code>pivot_longer()</code>, um die Produktnamen als
Werte in einer neuen Spalte namens “Produkt” zu erfassen.</p>
<div class="sourceCode" id="cb157"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>daten <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Produkt_A, <span class="sc">~</span>Produkt_B, <span class="sc">~</span>Produkt_C,</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>, <span class="dv">8</span>, <span class="dv">5</span>,</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">15</span>, <span class="dv">12</span>, <span class="dv">10</span>,</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">20</span>, <span class="dv">18</span>, <span class="dv">15</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div></li>
<li><p>Transformiere lange Daten in breite Daten: Angenommen, du hast
einen Datensatz mit den Spalten “Land”, “Monat” und “Besucher”, wobei
jeder Eintrag die Anzahl der Besucher in einem bestimmten Monat und Land
darstellt. Verwende <code>pivot_wider()</code>, um die Daten in das
ursprüngliche breite Format zurückzuführen.</p>
<div class="sourceCode" id="cb158"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>daten <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Land, <span class="sc">~</span>Monat, <span class="sc">~</span>Besucher,</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Deutschland&quot;</span>, <span class="st">&quot;Januar&quot;</span>, <span class="dv">100</span>,</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Deutschland&quot;</span>, <span class="st">&quot;Februar&quot;</span>, <span class="dv">120</span>,</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;USA&quot;</span>, <span class="st">&quot;Januar&quot;</span>, <span class="dv">150</span>,</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;USA&quot;</span>, <span class="st">&quot;Februar&quot;</span>, <span class="dv">180</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div></li>
<li><p>Erstelle neue Spalten aus einer einzelnen Spalte: Angenommen, du
hast einen Datensatz mit den Spalten “ID”, “Kategorie” und “Wert”, wobei
die Kategorien die verschiedenen Eigenschaften der IDs darstellen.
Verwende <code>pivot_wider()</code>, um aus der Spalte “Kategorie” neue
Spalten zu erstellen, die die entsprechenden Werte enthalten.</p>
<div class="sourceCode" id="cb159"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>daten <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>ID, <span class="sc">~</span>Kategorie, <span class="sc">~</span>Wert,</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&quot;A&quot;</span>, <span class="dv">10</span>,</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&quot;B&quot;</span>, <span class="dv">20</span>,</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;A&quot;</span>, <span class="dv">15</span>,</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;B&quot;</span>, <span class="dv">25</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div></li>
<li><p>Summiere Werte aus mehreren Zeilen: Angenommen, du hast einen
Datensatz mit den Spalten “Kategorie”, “Monat” und “Wert”, wobei der
Wert die monatlichen Verkäufe in einer bestimmten Kategorie darstellt.
Verwende <code>pivot_wider()</code>, um die monatlichen Werte für jede
Kategorie zu summieren und in neuen Spalten darzustellen.</p>
<div class="sourceCode" id="cb160"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>daten <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Kategorie, <span class="sc">~</span>Monat, <span class="sc">~</span>Wert,</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A&quot;</span>, <span class="st">&quot;Januar&quot;</span>, <span class="dv">100</span>,</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;A&quot;</span>, <span class="st">&quot;Februar&quot;</span>, <span class="dv">120</span>,</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;B&quot;</span>, <span class="st">&quot;Januar&quot;</span>, <span class="dv">150</span>,</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;B&quot;</span>, <span class="st">&quot;Februar&quot;</span>, <span class="dv">180</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Hinweis für Übungsaufgabe 7 und 8:</strong> Du kannst den
<code>mtcars</code>-Datensatz mit <code>data(mtcars)</code> laden und
den <code>iris</code>-Datensatz mit <code>data(iris)</code>.</p></li>
<li><p>Verwende den eingebauten Datensatz “mtcars”, der Informationen
über verschiedene Automodelle enthält, um folgende Transformationen
durchzuführen:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Verwende <code>pivot_longer()</code> um die Spalten “mpg”, “hp”
und “wt” in eine längere Form zu bringen. Die Spalte “variable” sollte
die ursprünglichen Spaltennamen (“mpg”, “hp”, “wt”) enthalten und die
Spalte “value” sollte die entsprechenden Werte enthalten.</p></li>
<li><p>Verwende <code>pivot_wider()</code> um die längeren Daten aus
Schritt a) zurück in die ursprüngliche Form zu bringen. Die Spalten
“variable” sollten die ursprünglichen Spaltennamen (“mpg”, “hp”, “wt”)
sein und die Werte sollten in den entsprechenden Spalten enthalten
sein.</p></li>
</ol></li>
<li><p>Verwende den eingebauten Datensatz “iris”, der Messungen von
Blüten enthält, um folgende Transformationen durchzuführen:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Verwende <code>pivot_longer()</code> um die Spalten
“Sepal.Length”, “Sepal.Width”, “Petal.Length” und “Petal.Width” in eine
längere Form zu bringen. Die Spalte “variable” sollte die ursprünglichen
Spaltennamen (“Sepal.Length”, “Sepal.Width”, “Petal.Length”,
“Petal.Width”) enthalten und die Spalte “value” sollte die
entsprechenden Werte enthalten.</p></li>
<li><p>Verwende <code>pivot_wider()</code> um die längeren Daten aus
Schritt a) zurück in die ursprüngliche Form zu bringen. Die Spalte
“variable” sollte die ursprünglichen Spaltennamen (“Sepal.Length”,
“Sepal.Width”, “Petal.Length”, “Petal.Width”) sein und die Werte sollten
in den entsprechenden Spalten enthalten sein.</p></li>
</ol></li>
</ol>
</div>
</div>
<div id="joining-der-daten" class="section level1">
<h1>Joining der Daten</h1>
<div id="grundlagen" class="section level2">
<h2>Grundlagen</h2>
<p>Um zwei DataFrames mit einander zu verbinden, bedienen wir uns der
<code>.join()</code>-Funktionen. Die Art und Weise, wie diese Funktion
funktioniert ist dabei sehr an die Sprache <a
href="https://de.wikipedia.org/wiki/SQL">SQL</a> für <a
href="https://de.wikipedia.org/wiki/Relationale_Datenbank">relationale
Datenbanken</a> angelegt; dabei meine ich nicht so sehr die Syntax, als
die <em>Denkweise</em> von SQL.</p>
<p>Möchte man in SQL <em>zwei</em> Tabellen einer Datenbank miteinander
verknüpfen, als einen sog. <em>Join</em> machen, betrachtet man die
Inhalte der Tabellen wie zwei Mengen (im mathematischen Sinn), die man
auf vier unterschiedliche Weise verknüpfen kann. Diese Weisen der
Verknüpfung lassen sich auch in sog. <a
href="https://de.wikipedia.org/wiki/Mengendiagramm">Venn Diagrammen</a>
darstellen. Bei der Darstellung mit Venn Diagrammen von der Verknüpfung
von genau <em>zwei</em> Mengen gibt es immer eine <em>linke</em> Seite,
eine <em>rechte</em> Seite, einen <em>inneren</em> Bereich und einen
<em>äuẞeren</em> Bereich. Dies sind dann auch genau die vier Grundarten
(es gibt noch ein paar speziellere aber weniger wichtige Arte), wie sich
in SQL Tabellen miteinander verbinden lassen. Dementsprechend spricht
man von einem <em>left</em>, einem <em>right</em>, einem <em>inner</em>
und einem <em>outer</em> Join.</p>
<p>Folgende Schaubilder aus dem <a
href="https://github.com/datenschauer/python-stats-course/tree/main">Kurs
Statistik und Datenanalyse mit Python</a> von Stefan Böhringer
veranschaulichen das sehr gut:</p>
<img src="images/python_stats/inner_join.png" /> <img
src="images/python_stats/left_join.png" /> <img
src="images/python_stats/right_join.png" /> <img
src="images/python_stats/outer_join.png" />
<div class="hinweis"
style="background-color: #D6EAF8; color: #34495E; border-left: solid #34495E 4px; border-radius: 4px; padding: 0.7em;">
<p style="margin:1em;">
Eine alternative Beschreibung mit anderer Visualisierung findet sich in
<a href="https://r4ds.hadley.nz/joins.html#how-do-joins-work">Kapitel
20.4 How do joins work?</a> von R4DS
</p>
</div>
<p>Gehen wir zurück zum Datensatz aus R4DS und einem komplexeren, aber
durchaus realistischen Fall.</p>
</div>
<div id="keys" class="section level2">
<h2>Keys</h2>
<p>Um Joins zu verstehen, musst du darüber hinaus verstehen, wie zwei
Tabellen über ein Paar von Schlüsseln miteinander verbunden werden
können, innerhalb jeder Tabelle. In diesem Abschnitt lernst du die
beiden Arten von Schlüsseln kennen und sie anhand der Datensätze des
Pakets “nycflights13” beispielhaft zu sehen. Du lernst auch, wie du
überprüfen kannst, ob deine Schlüssel gültig sind, und was zu tun ist,
wenn deine Tabelle keinen Schlüssel hat.</p>
<div id="primärschlüssel-und-fremdschlüssel" class="section level3">
<h3>Primärschlüssel und Fremdschlüssel</h3>
<p>Jeder Join beinhaltet ein Paar von Schlüsseln: einen Primärschlüssel
und einen Fremdschlüssel. Ein <strong>Primärschlüssel</strong> ist eine
Variable oder eine Gruppe von Variablen, die jede Beobachtung eindeutig
identifiziert. Wenn mehr als eine Variable erforderlich ist, wird der
Schlüssel als <strong>zusammengesetzter Schlüssel</strong> bezeichnet.
Zum Beispiel in “nycflights13”:</p>
<ul>
<li><p><code>airlines</code> enthält zwei Datenfelder zu jeder
Fluggesellschaft: ihren Carrier-Code und ihren vollständigen Namen. Du
kannst eine Fluggesellschaft mit ihrem Carrier-Code identifizieren,
wodurch <code>carrier</code> der Primärschlüssel ist.</p>
<div class="sourceCode" id="cb161"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>airlines</span></code></pre></div>
<pre><code>## # A tibble: 16 × 2
##    carrier name                       
##    &lt;chr&gt;   &lt;chr&gt;                      
##  1 9E      Endeavor Air Inc.          
##  2 AA      American Airlines Inc.     
##  3 AS      Alaska Airlines Inc.       
##  4 B6      JetBlue Airways            
##  5 DL      Delta Air Lines Inc.       
##  6 EV      ExpressJet Airlines Inc.   
##  7 F9      Frontier Airlines Inc.     
##  8 FL      AirTran Airways Corporation
##  9 HA      Hawaiian Airlines Inc.     
## 10 MQ      Envoy Air                  
## 11 OO      SkyWest Airlines Inc.      
## 12 UA      United Air Lines Inc.      
## 13 US      US Airways Inc.            
## 14 VX      Virgin America             
## 15 WN      Southwest Airlines Co.     
## 16 YV      Mesa Airlines Inc.</code></pre></li>
<li><p><code>airports</code> enthält Daten zu jedem Flughafen. Jeden
Flughafen kannst du anhand seines dreistelligen Flughafencodes
identifizieren, wodurch <code>faa</code> der Primärschlüssel ist.</p>
<div class="sourceCode" id="cb163"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>airports</span></code></pre></div>
<pre><code>## # A tibble: 1,458 × 8
##    faa   name                    lat    lon   alt    tz dst   tzone
##    &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
##  1 04G   Lansdowne Airport      41.1  -80.6  1044    -5 A     Amer…
##  2 06A   Moton Field Municipa…  32.5  -85.7   264    -6 A     Amer…
##  3 06C   Schaumburg Regional    42.0  -88.1   801    -6 A     Amer…
##  4 06N   Randall Airport        41.4  -74.4   523    -5 A     Amer…
##  5 09J   Jekyll Island Airport  31.1  -81.4    11    -5 A     Amer…
##  6 0A9   Elizabethton Municip…  36.4  -82.2  1593    -5 A     Amer…
##  7 0G6   Williams County Airp…  41.5  -84.5   730    -5 A     Amer…
##  8 0G7   Finger Lakes Regiona…  42.9  -76.8   492    -5 A     Amer…
##  9 0P2   Shoestring Aviation …  39.8  -76.6  1000    -5 U     Amer…
## 10 0S9   Jefferson County Intl  48.1 -123.    108    -8 A     Amer…
## # ℹ 1,448 more rows</code></pre></li>
<li><p><code>planes</code> enthält Daten zu jedem Flugzeug. Ein Flugzeug
kannst du anhand seiner Kennung (Tail Number) identifizieren, wodurch
<code>tailnum</code> der Primärschlüssel ist.</p>
<div class="sourceCode" id="cb165"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>planes</span></code></pre></div>
<pre><code>## # A tibble: 3,322 × 9
##    tailnum  year type        manufacturer model engines seats speed
##    &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1 N10156   2004 Fixed wing… EMBRAER      EMB-…       2    55    NA
##  2 N102UW   1998 Fixed wing… AIRBUS INDU… A320…       2   182    NA
##  3 N103US   1999 Fixed wing… AIRBUS INDU… A320…       2   182    NA
##  4 N104UW   1999 Fixed wing… AIRBUS INDU… A320…       2   182    NA
##  5 N10575   2002 Fixed wing… EMBRAER      EMB-…       2    55    NA
##  6 N105UW   1999 Fixed wing… AIRBUS INDU… A320…       2   182    NA
##  7 N107US   1999 Fixed wing… AIRBUS INDU… A320…       2   182    NA
##  8 N108UW   1999 Fixed wing… AIRBUS INDU… A320…       2   182    NA
##  9 N109UW   1999 Fixed wing… AIRBUS INDU… A320…       2   182    NA
## 10 N110UW   1999 Fixed wing… AIRBUS INDU… A320…       2   182    NA
## # ℹ 3,312 more rows
## # ℹ 1 more variable: engine &lt;chr&gt;</code></pre></li>
<li><p><code>weather</code> enthält Daten zum Wetter an den
Abflugflughäfen. Du kannst jede Beobachtung durch die Kombination von
Ort und Uhrzeit identifizieren, wodurch <code>origin</code> und
<code>time_hour</code> der zusammengesetzte Primärschlüssel sind.</p>
<div class="sourceCode" id="cb167"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>weather</span></code></pre></div>
<pre><code>## # A tibble: 26,115 × 15
##    origin  year month   day  hour  temp  dewp humid wind_dir
##    &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1 EWR     2013     1     1     1  39.0  26.1  59.4      270
##  2 EWR     2013     1     1     2  39.0  27.0  61.6      250
##  3 EWR     2013     1     1     3  39.0  28.0  64.4      240
##  4 EWR     2013     1     1     4  39.9  28.0  62.2      250
##  5 EWR     2013     1     1     5  39.0  28.0  64.4      260
##  6 EWR     2013     1     1     6  37.9  28.0  67.2      240
##  7 EWR     2013     1     1     7  39.0  28.0  64.4      240
##  8 EWR     2013     1     1     8  39.9  28.0  62.2      250
##  9 EWR     2013     1     1     9  39.9  28.0  62.2      260
## 10 EWR     2013     1     1    10  41    28.0  59.6      260
## # ℹ 26,105 more rows
## # ℹ 6 more variables: wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;,
## #   precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre></li>
</ul>
<p>Ein <strong>Fremdschlüssel</strong> ist eine Variable (oder eine
Gruppe von Variablen), die zu einem Primärschlüssel in einer anderen
Tabelle korrespondiert. Beispiele dafür sind:</p>
<ul>
<li><code>flights$tailnum</code> ist ein Fremdschlüssel, der zum
Primärschlüssel <code>planes$tailnum</code> korrespondiert.</li>
<li><code>flights$carrier</code> ist ein Fremdschlüssel, der zum
Primärschlüssel <code>airlines$carrier</code> korrespondiert.</li>
<li><code>flights$origin</code> ist ein Fremdschlüssel, der zum
Primärschlüssel <code>airports$faa</code> korrespondiert.</li>
<li><code>flights$dest</code> ist ein Fremdschlüssel, der dem
Primärschlüssel <code>airports$faa</code> entspricht.</li>
<li><code>flights$origin</code>-<code>flights$time_hour</code> ist ein
zusammengesetzter Fremdschlüssel, der dem zusammengesetzten
Primärschlüssel
<code>weather$origin</code>-<code>weather$time_hour</code>
entspricht.</li>
</ul>
<p>Diese Beziehungen werden visuell hier zusammengefasst:</p>
<div class="figure">
<img src="images/r4ds/relational.png" alt="" />
<p class="caption">Grafik aus R for Data Science (2e): r4ds.hadley.nz
Verbindungen zwischen allen fünf Datensätzen im nycflights13-Paket.
Variablen, die einen Primärschlüssel bilden, sind grau eingefärbt und
mit Pfeilen mit ihren entsprechenden Fremdschlüsseln verbunden.</p>
</div>
<p>Du wirst eine interessante Funktion im Design dieser Schlüssel
bemerken: Die Primär- und Fremdschlüssel haben fast immer die gleichen
Namen, was, wie du gleich sehen wirst, das Verknüpfen erleichtert. Es
ist auch erwähnenswert, dass die Variablennamen, die in mehreren
Tabellen verwendet werden, in jedem Fall die gleiche Bedeutung haben. Es
gibt nur eine Ausnahme: <code>year</code> bedeutet das Abfahrtsjahr in
<code>flights</code> und das Herstellungsjahr in <code>planes</code>.
Das wird wichtig, wenn wir tatsächlich Tabellen miteinander
verknüpfen.</p>
</div>
<div id="überprüfung-der-primärschlüssel" class="section level3">
<h3>Überprüfung der Primärschlüssel</h3>
<p>Nachdem wir die Primärschlüssel in jeder Tabelle identifiziert haben,
ist es gute Praxis, zu überprüfen, ob sie tatsächlich jede Beobachtung
eindeutig identifizieren. Eine Möglichkeit dies zu tun, besteht darin,
die Anzahl der Primärschlüssel mit <code>count()</code> zu ermitteln und
nach Einträgen zu suchen, bei denen <code>n</code> größer als eins ist.
Dadurch wird deutlich, dass sowohl <code>planes</code> als auch
<code>weather</code> in Ordnung sind:</p>
<div class="sourceCode" id="cb169"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>planes <span class="sc">%&gt;%</span>  </span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(tailnum) <span class="sc">%&gt;%</span>  </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 0 × 2
## # ℹ 2 variables: tailnum &lt;chr&gt;, n &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb171"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>weather <span class="sc">%&gt;%</span>  </span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(time_hour, origin) <span class="sc">%&gt;%</span>  </span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 0 × 3
## # ℹ 3 variables: time_hour &lt;dttm&gt;, origin &lt;chr&gt;, n &lt;int&gt;</code></pre>
<p>Du solltest auch nach fehlenden Werten in deinen Primärschlüsseln
suchen - wenn ein Wert fehlt, kann er keine Beobachtung
identifizieren!</p>
<div class="sourceCode" id="cb173"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>planes <span class="sc">%&gt;%</span>  </span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(tailnum))</span></code></pre></div>
<pre><code>## # A tibble: 0 × 9
## # ℹ 9 variables: tailnum &lt;chr&gt;, year &lt;int&gt;, type &lt;chr&gt;, manufacturer &lt;chr&gt;, model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb175"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>weather <span class="sc">%&gt;%</span>  </span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(time_hour) <span class="sc">|</span> <span class="fu">is.na</span>(origin))</span></code></pre></div>
<pre><code>## # A tibble: 0 × 15
## # ℹ 15 variables: origin &lt;chr&gt;, year &lt;int&gt;, month &lt;int&gt;, day &lt;int&gt;, hour &lt;int&gt;, temp &lt;dbl&gt;, dewp &lt;dbl&gt;, humid &lt;dbl&gt;, wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;,
## #   wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="ersatzschlüssel" class="section level3">
<h3>Ersatzschlüssel</h3>
<p>Bisher haben wir noch nicht über den Primärschlüssel für
<code>flights</code> gesprochen. Dies ist hier nicht besonders wichtig,
da es keine Datensatz gibt, die ihn als Fremdschlüssel verwenden, aber
es ist dennoch nützlich, darüber nachzudenken, da es einfacher ist,
Beobachtungen zu bearbeiten, wenn wir eine Möglichkeit haben, sie
anderen zu beschreiben.</p>
<p>Nach etwas Nachdenken und Experimentieren haben wir festgestellt,
dass es drei Variablen gibt, die zusammen jede Flugreise eindeutig
identifizieren:</p>
<div class="sourceCode" id="cb177"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span>  </span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(time_hour, carrier, flight) <span class="sc">%&gt;%</span>  </span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 0 × 4
## # ℹ 4 variables: time_hour &lt;dttm&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, n &lt;int&gt;</code></pre>
<p>Bedeutet das Fehlen von Duplikaten automatisch, dass
<code>time_hour</code>-<code>carrier</code>-<code>flight</code> ein
Primärschlüssel ist? Es ist sicherlich ein guter Anfang, aber es
garantiert es nicht. Ist zum Beispiel Höhe und Breitengrad ein guter
Primärschlüssel für <code>airports</code>?</p>
<div class="sourceCode" id="cb179"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(alt, lat) <span class="sc">%&gt;%</span>  </span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##     alt   lat     n
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1    13  40.6     2</code></pre>
<p>Es ist offensichtlich keine gute Idee, einen Flughafen durch seine
Höhe und Breitengrad zu identifizieren, und im Allgemeinen ist es anhand
der Daten allein nicht möglich zu wissen, ob eine Kombination von
Variablen einen guten Primärschlüssel bildet oder nicht. Aber für Flüge
scheint die Kombination von <code>time_hour</code>, <code>carrier</code>
und <code>flight</code> vernünftig, da es sehr verwirrend für eine
Fluggesellschaft und ihre Kunden wäre, wenn es mehrere Flüge mit
derselben Flugnummer zur gleichen Zeit in der Luft gäbe.</p>
<p>Das heißt, es wäre vielleicht sinnvoller, einen einfachen numerischen
Ersatzschlüssel einzuführen, der die Zeilennummer verwendet:</p>
<div class="sourceCode" id="cb181"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span>  </span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>(), <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>flights2</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 20
##       id  year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1     1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2     2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3     3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4     4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5     5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6     6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7     7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8     8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9     9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10    10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # ℹ 336,766 more rows
## # ℹ 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Ersatzschlüssel können besonders nützlich sein, wenn man sich mit
anderen Menschen austauscht: Es ist viel einfacher, jemanden darum zu
bitten, sich den Flug 2001 anzusehen, als zu sagen, schau dir UA430 an,
der am 3. Januar 2013 um 9 Uhr abgeflogen ist.</p>
</div>
</div>
<div id="übung-5" class="section level2">
<h2>Übung 5</h2>
<ol style="list-style-type: decimal">
<li><p>Die Beziehung zwischen <code>weather</code> und
<code>airports</code> ist in der Visulaiserung der Relationen nicht
dargestellt. Was ist die Beziehung und wie sollte sie im Diagramm
dargestellt werden?</p></li>
<li><p><code>weather</code> enthält nur Informationen für die drei
Ursprungsflughäfen in New York City. Wenn es Wetteraufzeichnungen für
alle Flughäfen in den USA enthalten würde, welche zusätzliche Verbindung
würde es zu <code>flights</code> herstellen?</p></li>
<li><p>Wir wissen, dass einige Tage im Jahr besonders sind und weniger
Menschen als üblich fliegen (z.B. Heiligabend und Weihnachtstag). Wie
könntest du diese Daten als Datensatz darstellen? Was wäre der
Primärschlüssel? Wie würde er sich mit den vorhandenen Datensätzen
verbinden?</p></li>
<li><p>Zeichne ein Diagramm, das die Verbindungen zwischen den
Datensätzen <code>Batting</code>, <code>People</code> und
<code>Salaries</code> im Lahman-Paket veranschaulicht.</p></li>
</ol>
</div>
<div id="basic-joins" class="section level2">
<h2>Basic Joins</h2>
<p>Jetzt, da du verstehst, wie Datensätze über Schlüssel miteinander
verbunden sind, können wir anfangen, Joins zu verwenden, um das
<code>flights</code>-Datenset besser zu verstehen. dplyr stellt sechs
Join-Funktionen zur Verfügung: <code>left_join()</code>,
<code>inner_join()</code>, <code>right_join()</code>,
<code>full_join()</code>, <code>semi_join()</code> und
<code>anti_join()</code>. Sie alle haben die gleiche Schnittstelle: Sie
nehmen ein Paar von Datensätzen (<code>x</code> und <code>y</code>)
entgegen und geben einen Datensatz zurück. Die Reihenfolge der Zeilen
und Spalten in der Ausgabe wird hauptsächlich von <code>x</code>
bestimmt.</p>
<p>In diesem Abschnitt lernst du, wie du einen mutierenden Join,
<code>left_join()</code>, und zwei filternde Joins,
<code>semi_join()</code> und <code>anti_join()</code>, verwenden kannst.
Im nächsten Abschnitt lernst du genau, wie diese Funktionen
funktionieren, sowie die verbleibenden <code>inner_join()</code>,
<code>right_join()</code> und <code>full_join()</code>.</p>
</div>
<div id="übung-6" class="section level2">
<h2>Übung 6</h2>
<ol style="list-style-type: decimal">
<li><p>Gegeben sind zwei Datensätzen <code>df1</code> und
<code>df1</code> mit einer gemeinsamen Spalte “ID”.</p>
<div class="sourceCode" id="cb183"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Name =</span> <span class="fu">c</span>(<span class="st">&quot;Alice&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Charlie&quot;</span>, <span class="st">&quot;David&quot;</span>))</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>),</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Age =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>))</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li>Führe einen <code>left_join()</code> durch und speichere das
Ergebnis im Datensatz <code>merged_df</code>. Gib anschließend den
resultierenden Datensatz aus.</li>
<li>Führe einen <code>inner_join()</code> durch und speichere das
Ergebnis im Datensatz <code>merged_inner</code>. Gib anschließend den
resultierenden Datensatz aus.</li>
<li>Führe einen <code>right_join()</code> durch und speichere das
Ergebnis im Datensatz <code>merged_right</code>. Gib anschließend den
resultierenden Datensatz aus.</li>
<li>Führe einen <code>full_join()</code> durch und speichere das
Ergebnis im Datensatz <code>merged_full</code>. Gib anschließend den
resultierenden Datensatz aus.</li>
<li>Führe einen <code>semi_join()</code> durch und speichere das
Ergebnis im Datensatz <code>merged_semi</code>. Gib anschließend den
resultierenden Datensatz aus.</li>
<li>Führe einen <code>anti_join()</code> durch und speichere das
Ergebnis im Datensatz <code>merged_anti</code>. Gib anschließend den
resultierenden Datensatz aus.</li>
</ol></li>
</ol>
<div id="mutierende-joins" class="section level3">
<h3>Mutierende Joins</h3>
<p>Ein <strong>mutierender Join</strong> ermöglicht es dir, Variablen
aus zwei Datensätzen zu kombinieren: Zuerst werden die Beobachtungen
anhand ihrer Schlüssel abgeglichen und dann werden die Variablen von
einem Datensatz in den anderen kopiert. Ähnlich wie bei
<code>mutate()</code> fügen die Join-Funktionen die Variablen rechts
hinzu, daher werden die neuen Variablen möglicherweise nicht angezeigt,
wenn dein Datensatz viele Variablen enthält. Für diese Beispiele werden
wir es einfacher machen, zu sehen, was vor sich geht, indem wir einen
schmaleren Datensatz mit nur sechs Variablen erstellen:</p>
<p>Denke daran, dass du in RStudio auch <code>View()</code> verwenden
kannst, um dieses Problem zu umgehen.</p>
<div class="sourceCode" id="cb184"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="ot">&lt;-</span> flights <span class="sc">%&gt;%</span>  </span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, time_hour, origin, dest, tailnum, carrier)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>flights2</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 6
##     year time_hour           origin dest  tailnum carrier
##    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  
##  1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA     
##  2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA     
##  3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA     
##  4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6     
##  5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL     
##  6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA     
##  7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6     
##  8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV     
##  9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6     
## 10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA     
## # ℹ 336,766 more rows</code></pre>
<p>Es gibt vier Arten von mutierenden Joins, aber eine wirst du fast
immer verwenden: <code>left_join()</code>. Er ist besonders, weil die
Ausgabe immer die gleichen Zeilen wie <code>x</code> hat. (Das ist nicht
zu 100% korrekt, aber du erhältst eine Warnung, wenn das nicht der Fall
ist.) Der Hauptzweck von <code>left_join()</code> besteht darin,
zusätzliche Metadaten hinzuzufügen. Beispielsweise können wir
<code>left_join()</code> verwenden, um den vollen Namen der
Fluggesellschaft zu den <code>flights2</code>-Daten hinzuzufügen:</p>
<div class="sourceCode" id="cb186"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span> </span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airlines)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(carrier)`</code></pre>
<pre><code>## # A tibble: 336,776 × 7
##     year time_hour           origin dest  tailnum carrier name                    
##    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
##  1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      United Air Lines Inc.   
##  2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      United Air Lines Inc.   
##  3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      American Airlines Inc.  
##  4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      JetBlue Airways         
##  5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      Delta Air Lines Inc.    
##  6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      United Air Lines Inc.   
##  7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6      JetBlue Airways         
##  8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV      ExpressJet Airlines Inc.
##  9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6      JetBlue Airways         
## 10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      American Airlines Inc.  
## # ℹ 336,766 more rows</code></pre>
<p>Oder wir könnten die Temperatur und Windgeschwindigkeit herausfinden,
als jedes Flugzeug abgeflogen ist:</p>
<div class="sourceCode" id="cb189"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span>  </span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weather <span class="sc">%&gt;%</span>  <span class="fu">select</span>(origin, time_hour, temp, wind_speed))</span></code></pre></div>
<pre><code>## Joining with `by = join_by(time_hour, origin)`</code></pre>
<pre><code>## # A tibble: 336,776 × 8
##     year time_hour           origin dest  tailnum carrier  temp wind_speed
##    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;
##  1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA       39.0       12.7
##  2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA       39.9       15.0
##  3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA       39.0       15.0
##  4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6       39.0       15.0
##  5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL       39.9       16.1
##  6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA       39.0       12.7
##  7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6       37.9       11.5
##  8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV       39.9       16.1
##  9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6       37.9       13.8
## 10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA       39.9       16.1
## # ℹ 336,766 more rows</code></pre>
<p>Oder welche Größe das Flugzeug hatte, das geflogen ist:</p>
<div class="sourceCode" id="cb192"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span>  </span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(planes <span class="sc">%&gt;%</span>  <span class="fu">select</span>(tailnum, type, engines, seats))</span></code></pre></div>
<pre><code>## Joining with `by = join_by(tailnum)`</code></pre>
<pre><code>## # A tibble: 336,776 × 9
##     year time_hour           origin dest  tailnum carrier type                    engines seats
##    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                     &lt;int&gt; &lt;int&gt;
##  1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      Fixed wing multi engine       2   149
##  2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      Fixed wing multi engine       2   149
##  3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      Fixed wing multi engine       2   178
##  4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      Fixed wing multi engine       2   200
##  5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      Fixed wing multi engine       2   178
##  6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      Fixed wing multi engine       2   191
##  7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6      Fixed wing multi engine       2   200
##  8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV      Fixed wing multi engine       2    55
##  9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6      Fixed wing multi engine       2   200
## 10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;                         NA    NA
## # ℹ 336,766 more rows</code></pre>
<p>Wenn <code>left_join()</code> keine Übereinstimmung für eine Zeile in
<code>x</code> findet, füllt es die neuen Variablen mit fehlenden Werten
auf. Beispielsweise gibt es keine Informationen über das Flugzeug mit
der Tail-Nummer <code>N3ALAA</code>, daher werden der <code>type</code>,
die <code>engines</code> und die <code>seats</code> fehlen:</p>
<div class="sourceCode" id="cb195"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span>  </span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tailnum <span class="sc">==</span> <span class="st">&quot;N3ALAA&quot;</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(planes <span class="sc">%&gt;%</span>  <span class="fu">select</span>(tailnum, type, engines, seats))</span></code></pre></div>
<pre><code>## Joining with `by = join_by(tailnum)`</code></pre>
<pre><code>## # A tibble: 63 × 9
##     year time_hour           origin dest  tailnum carrier type  engines seats
##    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;int&gt; &lt;int&gt;
##  1  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA
##  2  2013 2013-01-02 18:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA
##  3  2013 2013-01-03 06:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA
##  4  2013 2013-01-07 19:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA
##  5  2013 2013-01-08 17:00:00 JFK    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA
##  6  2013 2013-01-16 06:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA
##  7  2013 2013-01-20 18:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA
##  8  2013 2013-01-22 17:00:00 JFK    ORD   N3ALAA  AA      &lt;NA&gt;       NA    NA
##  9  2013 2013-10-11 06:00:00 EWR    MIA   N3ALAA  AA      &lt;NA&gt;       NA    NA
## 10  2013 2013-10-14 08:00:00 JFK    BOS   N3ALAA  AA      &lt;NA&gt;       NA    NA
## # ℹ 53 more rows</code></pre>
</div>
<div id="spezifizierung-der-join-schlüssel" class="section level3">
<h3>Spezifizierung der Join-Schlüssel</h3>
<p>Standardmäßig verwendet <code>left_join()</code> alle Variablen, die
in beiden Datensätzen vorkommen, als den Join-Schlüssel, den sogenannten
<strong>natural</strong> Join. Dies ist eine nützliche Heuristik, aber
sie funktioniert nicht immer. Was passiert zum Beispiel, wenn wir
versuchen, <code>flights2</code> mit dem vollständigen
<code>planes</code>-Datensatz zu verbinden?</p>
<div class="sourceCode" id="cb198"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span>  </span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(planes)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(year, tailnum)`</code></pre>
<pre><code>## # A tibble: 336,776 × 13
##     year time_hour           origin dest  tailnum carrier type  manufacturer model engines seats speed engine
##    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
##  1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;       NA    NA    NA &lt;NA&gt;  
##  2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;       NA    NA    NA &lt;NA&gt;  
##  3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;       NA    NA    NA &lt;NA&gt;  
##  4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;       NA    NA    NA &lt;NA&gt;  
##  5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;       NA    NA    NA &lt;NA&gt;  
##  6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;       NA    NA    NA &lt;NA&gt;  
##  7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6      &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;       NA    NA    NA &lt;NA&gt;  
##  8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV      &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;       NA    NA    NA &lt;NA&gt;  
##  9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6      &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;       NA    NA    NA &lt;NA&gt;  
## 10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      &lt;NA&gt;  &lt;NA&gt;         &lt;NA&gt;       NA    NA    NA &lt;NA&gt;  
## # ℹ 336,766 more rows</code></pre>
<p>Es gibt viele fehlende Übereinstimmungen, weil unser Join versucht,
<code>tailnum</code> und <code>year</code> als zusammengesetzten
Schlüssel zu verwenden. Sowohl <code>flights</code> als auch
<code>planes</code> haben eine <code>year</code>-Spalte, aber sie
bedeuten unterschiedliche Dinge: <code>flights$year</code> ist das Jahr,
in dem der Flug stattgefunden hat, und <code>planes$year</code> ist das
Jahr, in dem das Flugzeug gebaut wurde. Wir möchten nur nach
<code>tailnum</code> verbinden, daher müssen wir eine explizite
Spezifikation mit <code>join_by()</code> angeben:</p>
<div class="sourceCode" id="cb201"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span>  </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(planes, <span class="fu">join_by</span>(tailnum))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 14
##    year.x time_hour           origin dest  tailnum carrier year.y type                    manufacturer     model       engines seats speed engine   
##     &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;                   &lt;chr&gt;            &lt;chr&gt;         &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    
##  1   2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA        1999 Fixed wing multi engine BOEING           737-824           2   149    NA Turbo-fan
##  2   2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA        1998 Fixed wing multi engine BOEING           737-824           2   149    NA Turbo-fan
##  3   2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA        1990 Fixed wing multi engine BOEING           757-223           2   178    NA Turbo-fan
##  4   2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6        2012 Fixed wing multi engine AIRBUS           A320-232          2   200    NA Turbo-fan
##  5   2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL        1991 Fixed wing multi engine BOEING           757-232           2   178    NA Turbo-fan
##  6   2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA        2012 Fixed wing multi engine BOEING           737-924ER         2   191    NA Turbo-fan
##  7   2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6        2000 Fixed wing multi engine AIRBUS INDUSTRIE A320-232          2   200    NA Turbo-fan
##  8   2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV        1998 Fixed wing multi engine CANADAIR         CL-600-2B19       2    55    NA Turbo-fan
##  9   2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6        2004 Fixed wing multi engine AIRBUS           A320-232          2   200    NA Turbo-fan
## 10   2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA          NA &lt;NA&gt;                    &lt;NA&gt;             &lt;NA&gt;             NA    NA    NA &lt;NA&gt;     
## # ℹ 336,766 more rows</code></pre>
<p>Beachte, dass die <code>year</code>-Variablen in der Ausgabe mit
einem Suffix (<code>year.x</code> und <code>year.y</code>) eindeutig
gekennzeichnet sind, der angibt, ob die Variable aus dem <code>x</code>-
oder <code>y</code>-Argument stammt. Du kannst die Standard-Suffixe mit
dem Argument <code>suffix</code> überschreiben.</p>
<p><code>join_by(tailnum)</code> steht für
<code>join_by(tailnum == tailnum)</code>. Es ist wichtig, diese
ausführlichere Form aus zwei Gründen zu kennen. Erstens beschreibt sie
die Beziehung zwischen den beiden Tabellen: Die Schlüssel müssen
übereinstimmen. Daher wird dieser Typ von Join oft als
<strong>equi-join</strong> bezeichnet.</p>
<p>Zweitens kannst du damit verschiedene Join-Schlüssel in jeder Tabelle
angeben. Beispielsweise gibt es zwei Möglichkeiten, die Tabellen
<code>flight2</code> und <code>airports</code> zu verbinden: entweder
nach <code>dest</code> oder nach <code>origin</code>:</p>
<div class="sourceCode" id="cb203"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span>  </span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports, <span class="fu">join_by</span>(dest <span class="sc">==</span> faa))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 13
##     year time_hour           origin dest  tailnum carrier name                              lat   lon   alt    tz dst   tzone           
##    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;           
##  1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      George Bush Intercontinental     30.0 -95.3    97    -6 A     America/Chicago 
##  2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      George Bush Intercontinental     30.0 -95.3    97    -6 A     America/Chicago 
##  3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      Miami Intl                       25.8 -80.3     8    -5 A     America/New_York
##  4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      &lt;NA&gt;                             NA    NA      NA    NA &lt;NA&gt;  &lt;NA&gt;            
##  5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      Hartsfield Jackson Atlanta Intl  33.6 -84.4  1026    -5 A     America/New_York
##  6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      Chicago Ohare Intl               42.0 -87.9   668    -6 A     America/Chicago 
##  7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6      Fort Lauderdale Hollywood Intl   26.1 -80.2     9    -5 A     America/New_York
##  8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV      Washington Dulles Intl           38.9 -77.5   313    -5 A     America/New_York
##  9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6      Orlando Intl                     28.4 -81.3    96    -5 A     America/New_York
## 10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      Chicago Ohare Intl               42.0 -87.9   668    -6 A     America/Chicago 
## # ℹ 336,766 more rows</code></pre>
<div class="sourceCode" id="cb205"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span>  </span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(airports, <span class="fu">join_by</span>(origin <span class="sc">==</span> faa))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 × 13
##     year time_hour           origin dest  tailnum carrier name                  lat   lon   alt    tz dst   tzone           
##    &lt;int&gt; &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;           
##  1  2013 2013-01-01 05:00:00 EWR    IAH   N14228  UA      Newark Liberty Intl  40.7 -74.2    18    -5 A     America/New_York
##  2  2013 2013-01-01 05:00:00 LGA    IAH   N24211  UA      La Guardia           40.8 -73.9    22    -5 A     America/New_York
##  3  2013 2013-01-01 05:00:00 JFK    MIA   N619AA  AA      John F Kennedy Intl  40.6 -73.8    13    -5 A     America/New_York
##  4  2013 2013-01-01 05:00:00 JFK    BQN   N804JB  B6      John F Kennedy Intl  40.6 -73.8    13    -5 A     America/New_York
##  5  2013 2013-01-01 06:00:00 LGA    ATL   N668DN  DL      La Guardia           40.8 -73.9    22    -5 A     America/New_York
##  6  2013 2013-01-01 05:00:00 EWR    ORD   N39463  UA      Newark Liberty Intl  40.7 -74.2    18    -5 A     America/New_York
##  7  2013 2013-01-01 06:00:00 EWR    FLL   N516JB  B6      Newark Liberty Intl  40.7 -74.2    18    -5 A     America/New_York
##  8  2013 2013-01-01 06:00:00 LGA    IAD   N829AS  EV      La Guardia           40.8 -73.9    22    -5 A     America/New_York
##  9  2013 2013-01-01 06:00:00 JFK    MCO   N593JB  B6      John F Kennedy Intl  40.6 -73.8    13    -5 A     America/New_York
## 10  2013 2013-01-01 06:00:00 LGA    ORD   N3ALAA  AA      La Guardia           40.8 -73.9    22    -5 A     America/New_York
## # ℹ 336,766 more rows</code></pre>
<p>In älterem Code kannst du eine andere Art der Spezifizierung der
Join-Schlüssel sehen, indem du einen Zeichenvektor verwendest:</p>
<ul>
<li><code>by = "x"</code> entspricht <code>join_by(x)</code>.</li>
<li><code>by = c("a" = "x")</code> entspricht
<code>join_by(a == x)</code>.</li>
</ul>
<p>Jetzt, da <code>join_by()</code> existiert, bevorzugen wir es, da es
eine klarere und flexiblere Spezifikation ermöglicht.</p>
<p><code>inner_join()</code>, <code>right_join()</code>,
<code>full_join()</code> haben die gleiche Schnittstelle wie
<code>left_join()</code>. Der Unterschied besteht darin, welche Zeilen
beibehalten werden: Der Left Join behält alle Zeilen in <code>x</code>
bei, der Right Join behält alle Zeilen in <code>y</code> bei, der Full
Join behält alle Zeilen entweder in <code>x</code> oder <code>y</code>
bei, und der Inner Join behält nur Zeilen bei, die sowohl in
<code>x</code> als auch in <code>y</code> vorkommen.</p>
</div>
<div id="filtering-joins" class="section level3">
<h3>Filtering Joins</h3>
<p>Wie du dir vielleicht vorstellen kannst, besteht die Hauptfunktion
eines <strong>Filtering Joins</strong> darin, die Zeilen zu filtern. Es
gibt zwei Arten: Semi-Joins und Anti-Joins. <strong>Semi-Joins</strong>
behalten alle Zeilen in <code>x</code> bei, die eine Übereinstimmung in
<code>y</code> haben. Zum Beispiel könnten wir einen Semi-Join
verwenden, um den <code>airports</code>-Datensatz zu filtern und nur die
Ursprungsflughäfen anzuzeigen:</p>
<div class="sourceCode" id="cb207"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span>  </span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(flights2, <span class="fu">join_by</span>(faa <span class="sc">==</span> origin))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 8
##   faa   name                  lat   lon   alt    tz dst   tzone           
##   &lt;chr&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;           
## 1 EWR   Newark Liberty Intl  40.7 -74.2    18    -5 A     America/New_York
## 2 JFK   John F Kennedy Intl  40.6 -73.8    13    -5 A     America/New_York
## 3 LGA   La Guardia           40.8 -73.9    22    -5 A     America/New_York</code></pre>
<p>Oder nur die Zielorte:</p>
<div class="sourceCode" id="cb209"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>airports <span class="sc">%&gt;%</span>  </span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(flights2, <span class="fu">join_by</span>(faa <span class="sc">==</span> dest))</span></code></pre></div>
<pre><code>## # A tibble: 101 × 8
##    faa   name                                lat    lon   alt    tz dst   tzone            
##    &lt;chr&gt; &lt;chr&gt;                             &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;            
##  1 ABQ   Albuquerque International Sunport  35.0 -107.   5355    -7 A     America/Denver   
##  2 ACK   Nantucket Mem                      41.3  -70.1    48    -5 A     America/New_York 
##  3 ALB   Albany Intl                        42.7  -73.8   285    -5 A     America/New_York 
##  4 ANC   Ted Stevens Anchorage Intl         61.2 -150.    152    -9 A     America/Anchorage
##  5 ATL   Hartsfield Jackson Atlanta Intl    33.6  -84.4  1026    -5 A     America/New_York 
##  6 AUS   Austin Bergstrom Intl              30.2  -97.7   542    -6 A     America/Chicago  
##  7 AVL   Asheville Regional Airport         35.4  -82.5  2165    -5 A     America/New_York 
##  8 BDL   Bradley Intl                       41.9  -72.7   173    -5 A     America/New_York 
##  9 BGR   Bangor Intl                        44.8  -68.8   192    -5 A     America/New_York 
## 10 BHM   Birmingham Intl                    33.6  -86.8   644    -6 A     America/Chicago  
## # ℹ 91 more rows</code></pre>
<p><strong>Anti-Joins</strong> sind das Gegenteil: Sie geben alle Zeilen
in <code>x</code> zurück, die keine Übereinstimmung in <code>y</code>
haben. Sie sind nützlich, um fehlende Werte zu finden, die im
Datenbestand <strong>implizit</strong> sind. Implizit fehlende Werte
werden nicht als <code>NA</code> angezeigt, sondern existieren nur durch
ihre Abwesenheit. Beispielsweise können wir Zeilen finden, die in
<code>airports</code> fehlen, indem wir nach Flügen suchen, die keinen
passenden Zielflughafen haben:</p>
<div class="sourceCode" id="cb211"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span>  </span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(airports, <span class="fu">join_by</span>(dest <span class="sc">==</span> faa)) <span class="sc">%&gt;%</span>  </span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(dest)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 1
##   dest 
##   &lt;chr&gt;
## 1 BQN  
## 2 SJU  
## 3 STT  
## 4 PSE</code></pre>
<p>Oder wir können herausfinden, welche <code>tailnum</code>s in
<code>planes</code> fehlen:</p>
<div class="sourceCode" id="cb213"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>flights2 <span class="sc">%&gt;%</span> </span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(planes, <span class="fu">join_by</span>(tailnum)) <span class="sc">%&gt;%</span>  </span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(tailnum)</span></code></pre></div>
<pre><code>## # A tibble: 722 × 1
##    tailnum
##    &lt;chr&gt;  
##  1 N3ALAA 
##  2 N3DUAA 
##  3 N542MQ 
##  4 N730MQ 
##  5 N9EAMQ 
##  6 N532UA 
##  7 N3EMAA 
##  8 N518MQ 
##  9 N3BAAA 
## 10 N3CYAA 
## # ℹ 712 more rows</code></pre>
</div>
</div>
</div>
<div id="gut-aussehen-mit-ggplot" class="section level1">
<h1>Gut aussehen mit ggplot</h1>
<p>Sobald du den anfänglichen Abschnitt des Skripts gelesen hast,
bekommst du zumindest einen oberflächlichen Einblick in die
grundlegenden Instrumente, die für die Durchführung von Datenanalysen
erforderlich sind. Jetzt ist es an der Zeit, in die Tiefe zu gehen und
detailliertere Informationen zu erhalten. Im folgenden Abschnitt des
Buches wirst du einen umfassenderen Einblick in die Kunst der
Datenvisualisierung erhalten.</p>
<div id="die-grundlagen" class="section level2">
<h2>Die Grundlagen</h2>
<p>Jeder Graph in ggplot2 besteht aus mindestens den folgenden drei
Komponenten: - Die Daten und wie die Datenpunkte einander zugeordnet
sind. - Einem Satz geometrischer Objekte, auch Geoms genannt (visuelle
Markierungen, die die Datenpunkte darstellen, z.B. Balken, Punkte oder
Linien). - Ein Koordinatensystem.</p>
<p>Zusätzlich zu den Grundebenen bietet ggplot2 viele weitere Ebenen, um
Diagramme durch Einfärben, Skalieren, Aufteilen oder Hinzufügen
statistischer Transformationen an die Daten anzupassen.</p>
</div>
<div id="geometrische-objekte-geoms" class="section level2">
<h2>Geometrische Objekte (Geoms)</h2>
<p>Die verfügbaren Geoms variieren je nach Dimensionalität und Typ der
dargestellten Variable(n). Es ist eine gute Idee, das ggplot2 Cheatsheet
von Posit zur Hand zu haben, da es eine Zusammenfassung der verfügbaren
Geoms bietet. Alle Geoms in ggplot haben bestimmte Anforderungen an die
Variablen. Dazu gehört zum Beispiel, ob es sich um eine kontinuierliche
oder diskrete Variable handelt. Einige aesthetics können nur mit
kategorischen Variablen arbeiten, wie z.B. die Form eines Punktes:
Dreiecke, Kreise, Quadrate, etc. Einige aesthetics arbeiten mit
kategorischen oder kontinuierlichen Variablen, wie z. B. der x-Position
(horizontal). Bei einem Balkendiagramm muss die Variable kategorisch
sein - eine kontinuierliche Variable auf der x-Achse würde keinen Sinn
ergeben. Bei einem Streudiagramm muss die Variable kontinuierlich sein.
Beide Datentypen (kategorial und kontinuierlich) können auf den
ästhetischen Raum der x-Position abgebildet werden, erfordern aber
unterschiedliche Skalentypen. Neben der Skalierung ist auch die Anzahl
der Variablen entscheidend. Einige Plots benötigen nur eine Variable,
während andere zwei Variablen benötigen. Dies wird im Folgenden für die
einzelnen Plots betrachtet:</p>
<div id="scatter-plot" class="section level3">
<h3>Scatter Plot</h3>
<p>Variablen: zwei Variablen, beide kontinuierlich</p>
<p>Weitere Dimensionen: <del>alpha,</del> color, fill, shape,
<del>size,</del> stroke</p>
<p>Minimalbeispiel:</p>
<div class="sourceCode" id="cb215"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(cty, hwy, <span class="at">color =</span> trans)) <span class="sc">+</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-111-1.png" width="672" /></p>
<p>Weiteres Beispiel:</p>
<div class="sourceCode" id="cb216"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width)) <span class="sc">+</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
<div class="sourceCode" id="cb217"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flights, <span class="fu">aes</span>(<span class="at">x =</span> air_time, <span class="at">y =</span> distance)) <span class="sc">+</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 9430 rows containing missing values (`geom_point()`).</code></pre>
<img src="index_files/figure-html/unnamed-chunk-113-1.png" width="672" />
<div class="hinweis"
style="background-color: #D6EAF8; color: #34495E; border-left: solid #34495E 4px; border-radius: 4px; padding: 0.7em;">
<p style="margin:1em;">
Die Daten sind nicht unbedingt perfekt für ein Punktdiagramm.
Letztendlich werden hier Strecken dargestellt - Werte dazwischen kommen
nicht vor. Sie können jedoch theoretisch auftreten. Dennoch ist ein
horizontaler Boxplot für ausgewählte Routen vorzuziehen.
</p>
</div>
<p><br></p>
</div>
<div id="line-graph" class="section level3">
<h3>Line Graph</h3>
<p>Variablen: zwei Variablen, beide kontinuierlich</p>
<p>Weitere Dimensionen: <del>alpha,</del> color, group, linetype,
<del>size</del></p>
<p>Minimalbeispiel:</p>
<div class="sourceCode" id="cb219"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(economics, <span class="fu">aes</span>(date, unemploy)) <span class="sc">+</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-114-1.png" width="672" /></p>
<p>Weiteres Beispiel: Aktienkurs</p>
</div>
<div id="boxplot" class="section level3">
<h3>Boxplot</h3>
<p>Variablen: zwei Variablen, eine diskret, eine kontinuierlich</p>
<p>Weitere Dimensionen: lower, middle, upper, ymax, ymin,
<del>alpha,</del> color, fill, group, linetype, <del>shape,</del>
<del>size,</del> <del>weight</del></p>
<p>Minimalbeispiel:</p>
<div class="sourceCode" id="cb220"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(class, hwy)) <span class="sc">+</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-115-1.png" width="672" /></p>
<p>Weiteres Beispiel:</p>
<div class="sourceCode" id="cb221"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Species)) <span class="sc">+</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-116-1.png" width="672" /></p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
